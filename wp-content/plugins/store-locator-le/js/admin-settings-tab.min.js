let slp_setting_helper=function(){let turned_on={},upload_div_id,formData=new FormData(),settings_file=jQuery("#settings_file"),_this=this;this.download=function(f,d,e){var c=new window.Blob([d],{type:e});if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(c,f)}else{var b=document.createElement("a");b.href=URL.createObjectURL(c);b.download=f;b.style.display="none";document.body.appendChild(b);b.click();document.body.removeChild(b)}};this.initialize=function(){jQuery("div[data-related_to]").hover(SLP_ADMIN.helper.related_on,SLP_ADMIN.helper.related_off);jQuery("a#export_settings").on("click",this.export_settings);settings_file.on("change",this.upload_settings)};this.export_settings=function(){let response="";jQuery.ajax({method:"GET",url:wp_data.rest_path+"options/all/",dataType:"json"}).fail(function(a,c,b){console.log(a,c,b);if(a.responseJSON&&a.responseJSON.message){jQuery("#"+_this.divID+" .map-messages").addClass("error").prepend(a.responseJSON.message).show()}}).done(function(a){if(a.state!==200){console.log("SLP settings export error")}_this.download("slp_settings.json",JSON.stringify(a),"application/json")})};this.import_settings=function(a){if(!a.url){return}formData.append("data_type","settings_json");formData.append("action","import-settings");formData.append("file-meta",JSON.stringify(a));formData.append("_wpnonce",wp_data.import_nonce);jQuery.ajax({url:wp_data.rest_path+"options/import/",data:formData,processData:false,contentType:false,dataType:"json",type:"POST",success:function(b){if(b.success){AdminUI.notifications.remove_all();AdminUI.notifications.add("info","Import of "+a.filename+completed)}else{AdminUI.notifications.add("info","Uploading "+a.filename+" failed.");if(b.data.message){AdminUI.notifications.add("error",b.data.message)}}},beforeSend:function(){upload_div_id=AdminUI.notifications.add("info","Importing "+a.filename+"&hellip;")},xhr:function(){var b=jQuery.ajaxSettings.xhr();if(b.upload){b.upload.addEventListener("progress",function(d){if(d.lengthComputable){var c=(d.loaded/d.total)*100;c=c.toFixed(2);AdminUI.notifications.update(upload_div_id,"Server received "+c+"%")}},false)}return b}})};this.upload_settings=function(a){a.preventDefault();if(!settings_file[0].files[0].name){return}formData.append("data_type","settings_json");formData.append("action","upload-attachment");formData.append("async-upload",settings_file[0].files[0]);formData.append("name",settings_file[0].files[0].name);formData.append("_wpnonce",wp_data.nonce);jQuery.ajax({url:wp_data.upload_url,data:formData,processData:false,contentType:false,dataType:"json",type:"POST",success:function(b){if(b.success){AdminUI.notifications.remove_all();AdminUI.notifications.add("info","Upload complete to "+b.data.filename);_this.import_settings(b.data)}else{AdminUI.notifications.add("info","Uploading "+b.data.filename+" failed.");if(b.data.message){AdminUI.notifications.add("error",b.data.message)}}},error:function(b,d,c){AdminUI.notifications.add("info","Uploading failed.");AdminUI.notifications.add("error",d);AdminUI.notifications.add("error",c);AdminUI.notifications.add("error",b.responseText)},beforeSend:function(){upload_div_id=AdminUI.notifications.add("info","Uploading "+settings_file[0].files[0].name+"&hellip;")}})};this.related_on=function(){let related_to=jQuery(this).attr("data-related_to"),related_array=related_to.split(",");related_array.forEach(function(a){let related_element=jQuery('div[id*="'+a+'"]');jQuery(related_element).addClass("highlight-related");if(typeof turned_on[a]==="undefined"){turned_on[a]=related_element}})};this.related_off=function(){let property;for(property in turned_on){if(turned_on.hasOwnProperty(property)){let related_element=turned_on[property];jQuery(related_element).removeClass("highlight-related");turned_on[property]=undefined}}}};let SLP_Admin_Plugin_Style=function(){var c=false;var d;var b;var a=false;this.initialize=function(){this.style_obj=jQuery("#input-group-options_nojs\\[style\\]");this.user_is_premier=(jQuery(this.style_obj).attr("data-premier")==="1");jQuery("div.theme .button-secondary").on("click",SLP_Admin_Settings_Help.PluginStyle.set_active_style);jQuery(".wpcsl-style_vision_list").on("scroll",SLP_Admin_Settings_Help.PluginStyle.get_more_style);jQuery("select#options_nojs\\[theme\\]").on("change keyup",SLP_Admin_Settings_Help.PluginStyle.show_details);SLP_Admin_Settings_Help.PluginStyle.starting_theme=jQuery("select#options_nojs\\[theme\\] option:selected").val();jQuery("#wpcsl-option-view_sidemenu").on("click",SLP_Admin_Settings_Help.PluginStyle.show_details)};this.get_more_style=function(){if(!SLP_Admin_Settings_Help.PluginStyle.scroll_in_progress){SLP_Admin_Settings_Help.PluginStyle.scroll_in_progress=true;var f=SLP_Admin_Settings_Help.PluginStyle.style_obj;var h=jQuery(f).attr("data-page_len");var i=jQuery(f).attr("data-pages_loaded");var j="https://www.storelocatorplus.com/";var k="wp-json/wp/v2/slp_style_gallery";var g="?orderby=title&order=asc&per_page="+h+"&page="+ ++i;var e=j+k+g;jQuery.get(e,"",SLP_Admin_Settings_Help.PluginStyle.add_more_style).fail(function(l){SLP_Admin_Settings_Help.PluginStyle.scroll_in_progress=false;if(l.responseJSON.code==="rest_post_invalid_page_number"){jQuery(".wpcsl-style_vision_list").off("scroll")}})}};this.add_more_style=function(h){var f=SLP_Admin_Settings_Help.PluginStyle.style_obj;if(h.length<1){jQuery(f).attr("style","border-bottom: none; padding-bottom: 1em;");return}var g=jQuery(f).attr("data-pages_loaded");jQuery(f).attr("data-pages_loaded",++g);var i=jQuery(f).find(".card_list");var e="";jQuery(h).each(function(){e=SLP_Admin_Settings_Help.PluginStyle.vision_item_html(this);jQuery(i).append(e).find(".button-secondary").on("click",SLP_Admin_Settings_Help.PluginStyle.set_active_style)});SLP_Admin_Settings_Help.PluginStyle.scroll_in_progress=false};this.vision_item_html=function(i){var j="";if(jQuery("#options_nojs\\[style_id\\]").val()==i.id){j=" active "}var h="";if(typeof(i.custom_fields.access_level)!=="undefined"){h=i.custom_fields.access_level[0]}var k="";if((h=="")||SLP_Admin_Settings_Help.PluginStyle.user_is_premier){var g='data-post_id="'+i.id+'"';var e=(j=="")?jQuery("#select_text").val():jQuery("#active_text").val();k='<div class="card-section theme-actions"><a class="button button-secondary activate" '+g+' aria-label="'+e+'">'+e+"</a></div>"}var f='<div class="card theme '+h+j+'"><div class="card-divider"><h2 class="theme-name">'+i.title.rendered+'</h2></div><div class="card-section details">'+i.content.rendered+"</div>"+k+"</div>";return f};this.set_active_style=function(){var f=jQuery(this).attr("data-slug");jQuery("#options_nojs\\[style\\]").val(f);jQuery("#options_nojs\\[style_id\\]").val(jQuery(this).attr("data-post_id"));var e=jQuery("div.active");jQuery(e).find(".button-secondary").removeClass("customize").addClass("activate");jQuery(e).removeClass("active");jQuery("."+f).addClass("active");var e=jQuery("div.active");jQuery(e).find(".button-secondary").addClass("customize").text(jQuery("#activating_text").val());jQuery(e).removeClass("activate");jQuery(".button-primary").click()};this.show_details=function(){var f=jQuery("select#options_nojs\\[theme\\] option:selected").val();var g="#"+f+"_details";var e="<h3>"+jQuery("select#options_nojs\\[theme\\] option:selected").text()+"</h3>"+jQuery(g).html();jQuery(".settings-description").toggleClass("is-visible").html(e);if(f!==SLP_Admin_Settings_Help.PluginStyle.starting_theme){SLP_Admin_Settings_Help.PluginStyle.starting_theme=f;SLP_Admin_Settings_Help.PluginStyle.set_theme_options(g)}};this.set_theme_options=function(e){jQuery(e+" > .theme_option_value").each(function(f){var g=jQuery(this).attr("settings_field");jQuery('[name="'+g+'"]').val(jQuery(this).text())});return false}};jQuery(document).ready(function(){SLP_ADMIN.helper=new slp_setting_helper();SLP_ADMIN.helper.initialize();SLP_Admin_Settings_Help.PluginStyle=new SLP_Admin_Plugin_Style();SLP_Admin_Settings_Help.PluginStyle.initialize()});