function BPBMcheckPushWorkerStatus(){"serviceWorker"in navigator&&"PushManager"in window?navigator.serviceWorker.register("/bpbm-worker.js",{scope:"/"}).then(function(e){e.pushManager.getSubscription().then(function(e){null===e?(jQuery(".BPBMenablePushNotifications").show(),jQuery(".BPBMdisablePushNotifications").hide()):(jQuery(".BPBMenablePushNotifications").hide(),jQuery(".BPBMdisablePushNotifications").show(),jQuery.post(BP_Messages.ajaxUrl,{action:"bp_better_messages_save_user_push_subscription",nonce:BP_Messages.savePushNotificationsNonce,sub:JSON.stringify(e)}))})}):jQuery(".BPBMpushNotifications").hide()}function BPBMregisterPushWorker(){"serviceWorker"in navigator&&"PushManager"in window&&navigator.serviceWorker.register("/bpbm-worker.js",{scope:"/"}).then(function(e){e.pushManager.getSubscription().then(function(s){null===s&&e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:BPBMurlBase64ToUint8Array(BP_Messages.vapidPublicKey)}).then(function(e){jQuery.post(BP_Messages.ajaxUrl,{action:"bp_better_messages_save_user_push_subscription",nonce:BP_Messages.savePushNotificationsNonce,sub:JSON.stringify(e)}),jQuery(".BPBMenablePushNotifications").hide(),jQuery(".BPBMdisablePushNotifications").show()}).catch(function(e){BBPMShowError(e)})})})}function BPBMunregisterPushWorker(){"serviceWorker"in navigator&&"PushManager"in window&&navigator.serviceWorker.register("/bpbm-worker.js",{scope:"/"}).then(function(e){e.pushManager.getSubscription().then(function(e){null!==e&&e.unsubscribe().then(function(s){jQuery.post(BP_Messages.ajaxUrl,{action:"bp_better_messages_delete_user_push_subscription",nonce:BP_Messages.savePushNotificationsNonce,sub:JSON.stringify(e)}),jQuery(".BPBMenablePushNotifications").show(),jQuery(".BPBMdisablePushNotifications").hide()}).catch(function(e){})})})}function BPBMurlBase64ToUint8Array(e){for(var s=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),a=window.atob(s),t=new Uint8Array(a.length),i=0;i<a.length;++i)t[i]=a.charCodeAt(i);return t}function BBPMNotice(e){jQuery.amaran({theme:"colorful",content:{bgcolor:"black",color:"#fff",message:e},sticky:!1,closeOnClick:!0,closeButton:!0,delay:1e4,position:"bottom right"})}function BBPMShowError(e){jQuery.amaran({theme:"colorful",content:{bgcolor:"#c0392b",color:"#fff",message:e},sticky:!1,closeOnClick:!0,closeButton:!0,delay:1e4,position:"bottom right"})}function BBPMOpenMiniChat(e,s){jQuery(document).trigger("bp-better-messages-open-mini-chat",[e,s])}function BBPMOpenPrivateThread(e){jQuery(document).trigger("bp-better-messages-open-private-thread",[e])}!function(e){function s(s){void 0!==s[0].BPemojioneArea&&s[0].BPemojioneArea.trigger("change");var a=s.val();if(0===e(s).next(".bp-emojionearea").length)return a;var t=function(s){"<p>"!==(s=s.replace(/<p><\/p>/g,"")).substring(0,3)&&(s="<p>"+s);"</p>"!==s.substring(s.length-4)&&(s+="</p>");var a=e.parseHTML(s);e.each(a,function(s,a){var t=e(this);e.each(t.find("img.emojioneemoji,img.emojione"),function(){var s=e(this);s.replaceWith(s.attr("alt"))}),t.BPBMremoveAttributes(),t.find("*").BPBMremoveAttributes()});var t="";e.each(a,function(){t+=this.outerHTML}),"<p></p>"===t&&(t="");return t=t.replace(/&amp;/g,"&")}(a);return s.val(t),t}function a(s){0===e("."+J).length&&e('<div class="'+J+'"></div>').insertBefore(s);var a=s;a.addClass("bp-messages-mobile"),a.attr("id","bp-better-messages-mobile-view-container");var t=window.innerHeight;e("html").addClass("bp-messages-mobile").css("overflow","hidden"),e("body").addClass("bp-messages-mobile").css("min-height",t);var i=a.appendTo(e("body"));i.show();var r=0;r+=i.find(".chat-header").outerHeight(),i.find(".reply").length>0&&(r+=i.find(".reply").outerHeight());var n=t-r;i.find(".scroller").css({"max-height":"",height:n}),C(i),c(),v(),z=!0}function t(s){e.each(s,function(){var s=e('.bp-messages-wrap .list .messages-stack .content .messages-list li[data-id="'+this+'"]'),a=s.closest(".messages-stack");s.remove();0===a.find(".messages-list > li").length&&a.remove(),e('.bp-messages-wrap .threads-list .thread[data-message="'+this+'"] .info p').text("...")})}function i(){if(e.each(T,function(s,a){var t=e(a);if(t.is(".bp-messages-wrap-main")){var i=t.find("> .bp-messages-side-threads-wrapper .bp-messages-side-threads");if(i.length>0){var r=i.closest(".bp-messages-side-threads-wrapper"),n=2*i.width();n<800&&(n=800),t.width()<n?(r.addClass("threads-hidden"),i.hide()):(r.removeClass("threads-hidden"),i.show())}}}),T.hasClass("bp-messages-mobile")){var s=window.innerHeight,a=0;a+=T.find(".chat-header").outerHeight(),a+=T.find(".reply").outerHeight(),e(".scroller").css("height",s-a)}else!function(){var s=e(window).height()-50,a=e("#wpadminbar");a.length>0&&a.is(":visible")&&(s-=a.height()),s>BP_Messages.max_height&&(s=BP_Messages.max_height),s=parseInt(s),jQuery(".bp-messages-wrap .scroller").each(function(){var a=e(this),t=a.closest(".bp-messages-column");if(t.length>0&&t.parent().find(".bp-messages-side-threads").is(":visible")){var i=t.outerHeight()-t.find(".reply").outerHeight();a.css("max-height",i),a.css("height",i)}else a.css("max-height",s),a.css("height",s)}),jQuery(".bp-messages-wrap.bp-better-messages-list .scroller").css("max-height",s-50),jQuery(".bp-messages-wrap.bp-better-messages-mini .scroller").css("max-height",s-50)}()}function r(){function s(){jQuery(".bp-messages-wrap .scroller.thread").show(),jQuery(".bp-messages-wrap .bp-messages-call-container").hide();var e=jQuery(".bp-messages-wrap .bp-messages-video-container .bp-messages-main-video"),s=jQuery(".bp-messages-wrap .bp-messages-video-container .bp-messages-small-video");e.hide(),e.html(""),s.hide(),s.html(""),jQuery(".bp-messages-wrap .reply").show(),jQuery(".bp-messages-call-controls").hide(),jQuery(".bp-messages-call-controls .bpbm-enable-mic").hide(),jQuery(".bp-messages-call-controls .bpbm-disable-mic").show(),jQuery(".bp-messages-call-controls .bpbm-enable-video").hide(),jQuery(".bp-messages-call-controls .bpbm-disable-video").show(),clearInterval(I),!1!==k&&k.getTracks().forEach(function(e){e.stop()}),!1!==M&&M.close(),k=!1,C=!1,x=!1,M=!1,q=!1,clearInterval(V),clearInterval(K)}function i(){if(!0===O)return!1;ion.sound.play("calling",{loop:!0}),O=!0}function r(){if(!1===O)return!1;ion.sound.stop("calling"),O=!1}function o(e,s,a){if(e||(e={audio:!0,video:!0}),!s)throw"Second argument is mandatory. navigator.getUserMedia(hints,onsuccess,onfailure)";navigator.mediaDevices.getUserMedia(e).then(function(e){s(e)}).catch(function(e){if(!a)throw Error("getUserMedia failed: "+JSON.stringify(e,null,"\t"));a(e)})}function l(){if(!1!==M)return!1;try{var a=BP_Messages.turn_server;(M=new R({iceServers:[{urls:["turns:"+a,"turn:"+a],username:"wordplus",credential:"password"},{urls:"stun:"+a,username:"wordplus",credential:"password"},{urls:"stun:stun.l.google.com:19302"}]})).peers={},M.onicecandidate=function(e){e.candidate&&S.emit("mediaEvent",{event:"ice_message",candidate:e.candidate,to:M.participant})},M.oniceconnectionstatechange=function(e){"failed"!==M.iceConnectionState&&"disconnected"!==M.iceConnectionState&&"closed"!==M.iceConnectionState||(s(),BBPMNotice(BP_Messages.strings.connection_drop))},M.onice=function(e){if(M.peers[e.from]){M.addIceCandidate(e.candidate);for(var s=0;s<U.length;s++)M.addIceCandidate(U[s]);U=[]}else U.push(U)},M.ontrack=function(s){var a=!1;s.streams&&s.streams[0]?a=s.streams[0]:(E||(a=E=new MediaStream),E.addTrack(s.track)),"video"===s.track.kind&&function(s){l();var a=document.createElement("video");a.setAttribute("playsinline","true");var t=e(".bp-messages-video-container");t.find(".bp-messages-main-video").html(a),t.show(),a.srcObject=s,a.muted=!1,a.controls=!1,a.playsinline=!0,a.play(),_(t)}(a),"audio"===s.track.kind&&function(s){l();var a=document.createElement("audio");a.setAttribute("playsinline","true");e(".bp-messages-audio-element").html(a),a.srcObject=s,a.muted=!1,a.controls=!1,a.playsinline=!0,a.autoplay=!0,a.play()}(a)}}catch(e){console.error(e)}}function c(s){l();var a=document.createElement("video");a.setAttribute("playsinline","true");var t=e(".bp-messages-video-container");t.find(".bp-messages-small-video").show(),t.find(".bp-messages-small-video").html(a),t.show(),a.srcObject=s,a.controls=!0,a.muted=!0,a.controls=!1,a.playsinline=!0,a.play()}function d(){J=setTimeout(function(){m()},G),Y=setInterval(function(){X++},1e3)}function m(){if(clearTimeout(J),clearInterval(Y),0===X)return!1;var s=X+1;X=0;var a=jQuery(M.container),t=!1;a.hasClass("bp-messages-audio-container")?t="audio":a.hasClass("bp-messages-video-container")&&(t="video");var i=a.closest("[data-thread-id]").attr("data-thread-id"),r=a.find(".bpbm-cancel");r.hasClass("bpbm-blocked")?r.removeClass("bpbm-blocked"):r.click(),e.post(BP_Messages.ajaxUrl,{action:"bp_better_messages_record_missed_call",thread_id:i,type:t,duration:s})}function p(){clearTimeout(J),clearInterval(Y),X=0,V=setInterval(function(){$++},1e3);var s=jQuery(M.container),a=!1;s.hasClass("bp-messages-audio-container")?a="audio":s.hasClass("bp-messages-video-container")&&(a="video");var t=s.closest("[data-thread-id]").attr("data-thread-id");e.post(BP_Messages.ajaxUrl,{action:"bp_better_messages_register_started_call",thread_id:t,type:a},function(e){M.call_message_id=e}),K=setInterval(function(){e.post(BP_Messages.ajaxUrl,{action:"bp_better_messages_register_call_usage",call_message_id:M.call_message_id,duration:$})},1e3*Z)}function g(s,a,t){BBPMShowError(BP_Messages.strings.call_offline),"1"===BP_Messages.offlineCallsNotifications&&e.post(BP_Messages.ajaxUrl,{action:"bp_better_messages_record_offline_call",type:s,thread_id:a,user_id:t})}function v(e){var s=e.find(".scroller.thread"),a=s.height(),t=e.find(".reply"),i=a+=t.outerHeight();s.parent().hasClass("bp-messages-column")&&(i=a=e.height()-e.find(".chat-header").height()),a>i&&(a=i),t.hide(),e.find(".bp-messages-call-container").css("min-height",a),e.find(".bp-messages-main-placeholder").css("height",a)}function _(e){var s=e.closest(".bp-messages-wrap"),a=s.find(".scroller.thread").height(),t=s.find(".reply");if(a+=t.outerHeight(),e.find(".bp-messages-main-placeholder").is(":visible")){e.find(".bp-messages-main-placeholder").height(a),e.css("min-height",a),t.hide()}else e.find(".bp-messages-main-video").height(a)}function w(e){o({audio:!0,video:{minWidth:480,minHeight:240,maxWidth:1920,maxHeight:1080,facingMode:W?"user":"environment"}},function(s){var a=document.createElement("video");a.srcObject=s,a.controls=!0,a.muted=!0,a.setAttribute("playsinline","true"),function(){var e=jQuery(".bp-messages-wrap .bpbm-switch-camera-video");navigator.mediaDevices.enumerateDevices().then(function(s){var a=[];jQuery.each(s,function(e,s){"videoinput"===s.kind&&a.push(s)}),a.length>1?e.show():e.hide()}).catch(function(e){console.error(e)})}(),e(s,a,!1)},function(s){s&&e(null,null,s)})}function P(e){o({audio:!0,video:!1},function(s){var a=document.createElement("audio");a.srcObject=s,a.controls=!0,a.muted=!0,a.setAttribute("playsinline","true"),e(s,a,!1)},function(s){s&&e(null,null,s)})}try{S=io.connect(BP_Messages.socket_server,{upgrade:!0,rememberUpgrade:!0,secure:!0,transports:["polling","websocket"]})}catch(e){return console.error("Error connecting to the WebSocket Server. Please contact plugin developer. https://www.wordplus.org/contact/"),BP_Messages.realtime=0,!1}S.on("connect",function(){S.emit("authentication",BP_Messages.site_id,BP_Messages.user_id,BP_Messages.secret_key),BP_Messages.realtime=1}),S.on("disconnect",function(){BP_Messages.realtime=0}),S.on("reconnect",function(){BP_Messages.realtime=1});var M=!1,k=!1,C=!1,x=!1,E=!1,I=!1,U=[];jQuery(document).on("bpbm-end-call",s),jQuery(window).on("beforeunload",function(){if(q)return BP_Messages.strings.you_are_in_call});var O=!1,H={},z={},W=!0,F={optional:[],mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};S.on("mediaEvent",function(t){var n=e(".bp-messages-video-container"),o=n.closest(".bp-messages-wrap");switch(t.event){case"answered":l(),clearInterval(I),o.find(".bp-messages-main-placeholder").hide(),o.find(".bp-messages-main-placeholder .bp-messages-placeholder-video").html(""),o.find(".bp-messages-main-video").show(),n.find(".bp-messages-call-controls > *").hide(),n.find(".bp-messages-call-controls").show(),n.find(".bp-messages-call-controls > .bpbm-call-in-progress").show(),c(k),q=!0,p();break;case"answered_call":n=e(".bp-messages-audio-container"),l(),clearInterval(I),(o=n.closest(".bp-messages-wrap")).find(".bp-messages-placeholder-incoming-text, .bp-messages-placeholder-outgoing-text").hide();var d=o.find(".bp-messages-timer");d.show(),d.runner({format:function(e){return j(e)},milliseconds:!1}),d.runner("start"),n.find(".bp-messages-call-controls > *").hide(),n.find(".bp-messages-call-controls").show(),n.find(".bp-messages-call-controls > .bpbm-call-in-progress").show(),n.find(".bp-messages-call-controls > *").hide(),n.find(".bp-messages-call-controls").show(),n.find(".bp-messages-call-controls > .bpbm-call-in-progress").show(),q=!0,p();break;case"rejected":BBPMNotice(BP_Messages.strings.call_reject),clearInterval(I),q=!1,m(),s();break;case"calling":if(q)return!1;if(void 0!==H[t.from])return!1;if(l(),i(),Q&&t.thread_id===Q.toString()){o.find(".scroller.thread").hide(),v(o),n.show(),n.find(".bp-messages-placeholder-message > *").hide(),n.find(".bp-messages-placeholder-message > .bp-messages-placeholder-incoming-text").show(),n.find(".bp-messages-call-controls > *").hide(),n.find(".bp-messages-call-controls").show(),n.find(".bp-messages-call-controls > .bpbm-call-in").show(),n.find(".bp-messages-main-placeholder").show();(g=e(".bp-messages-wrap.bp-messages-wrap-main.mobile-ready")).length>0&&a(o),!1===C?w(function(e,s,a){if(!1!==a){console.error(a);var t=a.toString().split(":");BBPMShowError(BP_Messages.strings.cam_not_works+": "+t[1])}else k=e,C=s,n.find(".bp-messages-placeholder-video").html(C),C.controls=!1,C.play()}):(n.find(".bp-messages-placeholder-video").html(C),C.controls=!1,C.play())}else{0===(u=e(".amaran.incoming_call.thread_"+t.thread_id)).length&&e.amaran({theme:"user message thread_"+t.thread_id+" incoming_call",content:{img:t.avatar,user:t.name,message:'<div style="float: left;height: 35px;line-height: 35px;">'+BP_Messages.strings.incoming_call+'</div><div class="bp-messages-wrap bp-messages-popup"><div class="bpbm-call-in"><span class="bpbm-answer" data-thread-id="'+t.thread_id+'"  data-user-id="'+t.from+'" title="'+BP_Messages.strings.answer_call+'"><i class="fas fa-phone"></i></span><span class="bpbm-reject" data-thread-id="'+t.thread_id+'"  data-user-id="'+t.from+'" title="'+BP_Messages.strings.reject_call+'"><i class="fas fa-phone"></i></span></div></div>'},sticky:!0,closeOnClick:!1,closeButton:!1,delay:999999,thread_id:t.thread_id,position:"bottom right",onClick:function(){}})}void 0!==z[t.from]&&clearTimeout(z[t.from]),z[t.from]=setTimeout(function(){r(),s();var a=e(".amaran.incoming_call");a.length>0&&a.remove()},3e3);break;case"calling_audio":if(q)return!1;if(void 0!==H[t.from])return!1;if(l(),n=e(".bp-messages-audio-container"),i(),Q&&t.thread_id===Q.toString()){o.find(".scroller.thread").hide(),v(o),n.show(),n.find(".bp-messages-placeholder-message > *").hide(),n.find(".bp-messages-placeholder-message > .bp-messages-placeholder-incoming-text").show(),n.find(".bp-messages-call-controls > *").hide(),n.find(".bp-messages-call-controls").show(),n.find(".bp-messages-call-controls > .bpbm-call-in").show(),n.find(".bp-messages-main-placeholder").show();var g=e(".bp-messages-wrap.bp-messages-wrap-main.mobile-ready");g.length>0&&a(o),!1===x?P(function(e,s,a){if(!1!==a){console.error(a);var t=a.toString().split(":");BBPMShowError(BP_Messages.strings.cam_not_works+": "+t[1])}else k=e,(x=s).controls=!1,x.play()}):(x.controls=!1,x.play())}else{0===(u=e(".amaran.incoming_call.thread_"+t.thread_id)).length&&e.amaran({theme:"user message thread_"+t.thread_id+" incoming_call",content:{img:t.avatar,user:t.name,message:'<div style="float: left;height: 35px;line-height: 35px;">'+BP_Messages.strings.incoming_call+'</div><div class="bp-messages-wrap bp-messages-popup"><div class="bpbm-call-in"><span class="bpbm-answer" data-thread-id="'+t.thread_id+'"  data-user-id="'+t.from+'" title="'+BP_Messages.strings.answer_call+'"><i class="fas fa-phone"></i></span><span class="bpbm-reject" data-thread-id="'+t.thread_id+'"  data-user-id="'+t.from+'" title="'+BP_Messages.strings.reject_call+'"><i class="fas fa-phone"></i></span></div></div>'},sticky:!0,closeOnClick:!1,closeButton:!1,delay:999999,thread_id:t.thread_id,position:"bottom right",onClick:function(){}})}void 0!==z[t.from]&&clearTimeout(z[t.from]),z[t.from]=setTimeout(function(){r(),s();var a=e(".amaran.incoming_call");a.length>0&&a.remove()},3e3);break;case"offer":l();var h=new L(t.sdp);M.peers[t.from]=M.setRemoteDescription(h).then(function(){return k}).then(function(e){k.getTracks().forEach(function(e){M.addTrack(e,k)})}).then(function(){return M.createAnswer()}).then(function(e){return M.setLocalDescription(e)}).then(function(){S.emit("mediaEvent",{event:"answer",to:t.from,sdp:M.localDescription})});break;case"answer":l(),M.setRemoteDescription(new L(t.sdp));break;case"self_reject":r();(u=e(".amaran.incoming_call")).length>0&&u.remove(),H[t.from]="1",setTimeout(function(){delete H[t.from]},3e3);break;case"call_cancelled":r();var u=e(".amaran.incoming_call.thread_"+t.thread_id);u.length>0&&u.remove(),H[t.from]="1",setTimeout(function(){delete H[t.from]},3e3),s();break;case"call_end":s();break;case"ice_message":M.onice(t)}});var J,Y,V,K,G=1e3*BP_Messages.callRequestTimeLimit,X=0,Z=5,$=0;jQuery(document).on("click",".bp-messages-wrap .chat-header .video-call",function(s){s.preventDefault(),s.stopImmediatePropagation();var a=jQuery(this).data("user-id");if(S.connected){if(q)return!1;void 0===navigator.mediaDevices?BBPMShowError(BP_Messages.strings.no_webrtc):-1===A.indexOf(a.toString())?g("video",Q,a):w(function(s,t,i){if(!1!==i){console.error(i);var r=i.toString().split(":");BBPMShowError(BP_Messages.strings.cam_not_works+": "+r[1])}else{var n=e(".bp-messages-video-container");k=s,C=t,t.controls=!1,t.autoplay=!0,t.muted=!0,t.playsinline=!0,t.onplaying=function(){_(n)},n.find(".bp-messages-placeholder-video").html(t),t.play(),q=!0,d(),l(),M.participant=a,M.container=n;var o=n.closest(".bp-messages-wrap"),c=n.data("my-avatar"),m=n.data("my-name");v(o),o.find(".scroller.thread").hide(),n.show(),n.find(".bp-messages-placeholder-message > *").hide(),n.find(".bp-messages-placeholder-message > .bp-messages-placeholder-outgoing-text").show(),n.find(".bp-messages-call-controls > *").hide(),n.find(".bp-messages-call-controls").show(),n.find(".bp-messages-call-controls > .bpbm-call-out").show(),n.find(".bp-messages-main-placeholder").show(),S.emit("mediaEvent",{event:"calling",to:a,thread_id:Q,avatar:c,name:m}),I=setInterval(function(){S.emit("mediaEvent",{event:"calling",to:a,thread_id:Q,avatar:c,name:m})},2500),_(n)}})}else BBPMNotice(BP_Messages.strings.websocket_not_connected)}),jQuery(document).on("click",".bp-messages-wrap .chat-header .audio-call",function(s){s.preventDefault(),s.stopImmediatePropagation();var a=jQuery(this).data("user-id");if(S.connected){if(q)return!1;void 0===navigator.mediaDevices?BBPMShowError(BP_Messages.strings.no_webrtc):-1===A.indexOf(a.toString())?g("audio",Q,a):P(function(s,t,i){if(!1!==i){console.error(i);BBPMShowError("Micro not works: "+i.toString().split(":")[1])}else{d(),q=!0,l();var r=e(".bp-messages-audio-container");M.participant=a,M.container=r,k=s,x=t;var n=r.closest(".bp-messages-wrap");v(n);var o=r.data("my-avatar"),c=r.data("my-name");n.find(".scroller.thread").hide(),r.find(".bp-messages-placeholder-message > *").hide(),r.find(".bp-messages-placeholder-message > .bp-messages-placeholder-outgoing-text").show(),r.find(".bp-messages-call-controls > *").hide(),r.find(".bp-messages-call-controls").show(),r.find(".bp-messages-call-controls > .bpbm-call-out").show(),r.find(".bp-messages-main-placeholder").show(),r.show(),S.emit("mediaEvent",{event:"calling_audio",to:a,thread_id:Q,avatar:o,name:c}),I=setInterval(function(){S.emit("mediaEvent",{event:"calling_audio",to:a,thread_id:Q,avatar:o,name:c})},2500)}})}else BBPMNotice(BP_Messages.strings.websocket_not_connected)}),jQuery(document).on("click",".bp-messages-wrap .bp-messages-call-controls .bpbm-switch-camera-video",function(e){if(e.preventDefault(),e.stopImmediatePropagation(),!1!==k){var s=jQuery(this);k.getTracks().forEach(function(e){e.stop()}),W=!W,w(function(e,a,t){if(!1!==t){console.error(t);var i=t.toString().split(":");BBPMShowError(BP_Messages.strings.cam_not_works+": "+i[1])}else{var r=s.closest(".bp-messages-video-container");k=e,C=a;r.find(".bp-messages-placeholder-video").is(":visible")?(a.controls=!1,a.autoplay=!0,a.muted=!0,a.playsinline=!0,k.getAudioTracks()[0].enabled=!1,r.find(".bp-messages-placeholder-video").html(a),a.play()):c(k),jQuery.each(M.getSenders(),function(s,a){var t=e.getTracks().find(function(e){return e.kind===a.track.kind});a.replaceTrack(t)})}})}}),jQuery(document).on("click",".bp-messages-call-controls .bpbm-disable-video",function(e){e.preventDefault(),k.getVideoTracks()[0].enabled=!1,jQuery(".bp-messages-call-controls .bpbm-disable-video").hide(),jQuery(".bp-messages-call-controls .bpbm-enable-video").show()}),jQuery(document).on("click",".bp-messages-call-controls .bpbm-enable-video",function(e){e.preventDefault(),k.getVideoTracks()[0].enabled=!0,jQuery(".bp-messages-call-controls .bpbm-enable-video").hide(),jQuery(".bp-messages-call-controls .bpbm-disable-video").show()}),jQuery(document).on("click",".bp-messages-call-controls .bpbm-disable-mic",function(e){e.preventDefault(),k.getAudioTracks()[0].enabled=!1,jQuery(".bp-messages-call-controls .bpbm-disable-mic").hide(),jQuery(".bp-messages-call-controls .bpbm-enable-mic").show()}),jQuery(document).on("click",".bp-messages-call-controls .bpbm-enable-mic",function(e){e.preventDefault(),k.getAudioTracks()[0].enabled=!0,jQuery(".bp-messages-call-controls .bpbm-enable-mic").hide(),jQuery(".bp-messages-call-controls .bpbm-disable-mic").show()}),jQuery(document).on("click",".bp-messages-video-container .bp-messages-call-controls .bpbm-answer",function(s){if(s.preventDefault(),void 0===navigator.mediaDevices)BBPMShowError(BP_Messages.strings.no_webrtc);else{l();var a=jQuery(this).data("user-id");M.participant=a,void 0!==z[a]&&clearTimeout(z[a]),S.emit("mediaEvent",{event:"answered",to:a}),S.emit("mediaEvent",{event:"self_reject",to:BP_Messages.user_id}),H[a]="1",setTimeout(function(){delete H[a]},3e3),r();var t=e(".bp-messages-video-container"),i=t.closest(".bp-messages-wrap");i.find(".bp-messages-main-placeholder").hide(),i.find(".bp-messages-main-placeholder .bp-messages-placeholder-video").html(""),i.find(".bp-messages-main-video").show(),t.find(".bp-messages-call-controls > *").hide(),t.find(".bp-messages-call-controls").show(),t.find(".bp-messages-call-controls > .bpbm-call-in-progress").show(),c(k),"function"==typeof M.addTrack&&(k.getTracks().forEach(function(e){M.addTrack(e,k)}),M.peers[a]=M.createOffer(F).then(function(e){M.setLocalDescription(e).then(function(){S.emit("mediaEvent",{event:"offer",to:a,sdp:e})})}).catch(function(e){console.error(e)}))}}),jQuery(document).on("click",".bp-messages-audio-container .bp-messages-call-controls .bpbm-answer",function(s){if(s.preventDefault(),void 0===navigator.mediaDevices)BBPMShowError(BP_Messages.strings.no_webrtc);else{l();var a=jQuery(this).data("user-id");M.participant=a,void 0!==z[a]&&clearTimeout(z[a]),S.emit("mediaEvent",{event:"answered_call",to:a}),S.emit("mediaEvent",{event:"self_reject",to:BP_Messages.user_id}),H[a]="1",setTimeout(function(){delete H[a]},3e3),r();var t=e(".bp-messages-audio-container"),i=t.closest(".bp-messages-wrap");i.find(".bp-messages-placeholder-incoming-text, .bp-messages-placeholder-outgoing-text").hide();var n=i.find(".bp-messages-timer");n.show(),n.runner({format:function(e){return j(e)},milliseconds:!1}),n.runner("start"),t.find(".bp-messages-call-controls > *").hide(),t.find(".bp-messages-call-controls").show(),t.find(".bp-messages-call-controls > .bpbm-call-in-progress").show(),"function"==typeof M.addTrack&&(k.getTracks().forEach(function(e){M.addTrack(e,k)}),M.peers[a]=M.createOffer(F).then(function(e){M.setLocalDescription(e).then(function(){S.emit("mediaEvent",{event:"offer",to:a,sdp:e})})}).catch(function(e){console.error(e)}))}}),jQuery(document).on("click",".bp-messages-call-controls .bpbm-reject",function(e){e.preventDefault();var a=jQuery(this).data("user-id");r(),S.emit("mediaEvent",{event:"rejected",to:a}),S.emit("mediaEvent",{event:"self_reject",to:BP_Messages.user_id}),H[a]="1",setTimeout(function(){delete H[a]},3e3),s()}),jQuery(document).on("click",".bp-messages-video-container .bp-messages-call-controls .bpbm-cancel",function(a){a.preventDefault();var t=e(this);t.addClass("bpbm-blocked");var i=t.closest(".bp-messages-video-container");S.emit("mediaEvent",{event:"call_cancelled",to:M.participant,thread_id:i.data("thread-id")}),m(),s()}),jQuery(document).on("click",".bp-messages-audio-container .bp-messages-call-controls .bpbm-cancel",function(a){a.preventDefault();var t=e(this);t.addClass("bpbm-blocked");var i=t.closest(".bp-messages-audio-container");S.emit("mediaEvent",{event:"call_cancelled",to:M.participant,thread_id:i.data("thread-id")}),m(),s()}),jQuery(document).on("click",".bp-messages-video-container .bp-messages-call-controls .bpbm-call-end",function(e){e.preventDefault(),S.emit("mediaEvent",{event:"call_end",to:M.participant}),s()}),jQuery(document).on("click",".bp-messages-audio-container .bp-messages-call-controls .bpbm-call-end",function(e){e.preventDefault(),S.emit("mediaEvent",{event:"call_end",to:M.participant}),s()}),jQuery(document).on("click",".bp-messages-wrap.bp-messages-popup .bpbm-answer",function(e){e.preventDefault();var s=jQuery(this).data("thread-id");location.href=BP_Messages.threadUrl+s}),jQuery(document).on("click",".bp-messages-wrap.bp-messages-popup .bpbm-reject",function(a){a.preventDefault();var t=jQuery(this).data("user-id");e(this).closest(".amaran.incoming_call").remove(),r(),S.emit("mediaEvent",{event:"rejected",to:t}),S.emit("mediaEvent",{event:"self_reject",to:BP_Messages.user_id}),H[t]="1",setTimeout(function(){delete H[t]},3e3),s()}),S.on("getUnread",function(s){var a=e('.bp-better-messages-list > .tabs > div[data-tab="messages"]'),t=0,i=0,r=e(".bp-messages-wrap .threads-list").length;Object.keys(s.threads).length>0?(e.each(s.threads,function(s){B(s,this),N[s]=this,t+=parseInt(this),i++,r>0&&0===e('.bp-messages-wrap .threads-list .thread[data-id="'+s+'"]').length&&S.emit("threadOpen",s)}),r>0&&e(".bp-messages-wrap .threads-list .thread[data-id]").each(function(){var a=e(this).data("id");void 0===s.threads[a]&&B(a,0)})):(t=0,e(".threads-list .thread, .bp-better-messages-mini .chat").removeClass("unread"),e(".threads-list .thread .time .unread-count").text(""),e(".bp-better-messages-mini .chat .unread-count").attr("class","unread-count count-0").text(""),N={}),t>0?(a.find(".fas").hide(),a.find(".unread-count").text(t).show()):(a.find(".fas").show(),a.find(".unread-count").text("").hide()),e(document).trigger("bp-better-messages-update-unread",i)}),S.on("message_deleted",function(e){t([e])}),S.on("onlineUsers",function(e){A=e,h()}),S.on("userOnline",function(s){-1===A.indexOf(s)&&(A.push(s),e('.bbpm-avatar[data-user-id="'+s+'"]').addClass("online"))}),S.on("userOffline",function(s){A.indexOf(s)>-1&&(A.splice(A.indexOf(s),1),e('.bbpm-avatar[data-user-id="'+s+'"]').removeClass("online"))}),S.on("message",function(s){var a='.bp-better-messages-mini .chats .chat[data-thread="'+s.thread_id+'"]',t=e(a),i=e('.bp-better-messages-mini .chats .chat[data-thread="'+s.thread_id+'"].open');if("1"===BP_Messages.encryption){var r=s.thread_id,n=e('.bp-messages-wrap .thread.scroller[data-id="'+r+'"][data-secret]'),o=n.data("secret"),l=BP_Messages.encrypt_key;if(s.fast&&n.length>0){s.avatar=BPBMAES256.decrypt(s.avatar,o),s.link=BPBMAES256.decrypt(s.link,o),s.message=BPBMAES256.decrypt(s.message,o),s.name=BPBMAES256.decrypt(s.name,o);var c=s.message;c=jQuery("<div />").text(c).html();["p","b","i","u","strike","sub","sup","br"].forEach(function(e,s){var a=new RegExp("&lt;"+e+"&gt;","g"),t=new RegExp("&lt;/"+e+"&gt;","g");c=c.replace(a,"<"+e+">",c),c=c.replace(t,"</"+e+">",c)}),c=c.replace(/ style=\"\"/g,"",c),c=c.replace(/<br>/g,"\n",c),c=c.replace(/&nbsp;/g," ",c),c=c.replace(/&amp;nbsp;/g," ",c),"<p>"===(c=c.trim()).substring(0,3)&&(c=c.substring(3)),"</p>"===c.substring(c.length-4)&&(c=c.substring(0,c.length-4)),c=c.replace(/&amp;lt;/g,"&lt;",c),c=c.replace(/&amp;gt;/g,"&gt;",c),c=c.replace(/\n/g,"<br>",c),c=emojione.toImage(c),s.message=c}s.fast||(s.content_site=BPBMAES256.decrypt(s.content_site,l),s.html=BPBMAES256.decrypt(s.html,l),s.avatar=BPBMAES256.decrypt(s.avatar,l),s.name=BPBMAES256.decrypt(s.name,l),n.length>0&&(s.message=BPBMAES256.decrypt(s.message,o),s.link=BPBMAES256.decrypt(s.link,o)))}if(!s.fast&&"1"==BP_Messages.realtime){if(BP_Messages.user_id!=s.user_id){e("body").hasClass("bp-messages-mobile")&&parseInt(s.thread_id)===parseInt(Q)||ifvisible.now("active")&&(!1!==Q||i.length>0)?(S.emit("seen",[s.id]),S.emit("threadOpen",s.thread_id),y("bp-better-messages-thread-"+s.thread_id,s.timestamp,1)):S.emit("delivered",s.id)}else y("bp-better-messages-thread-"+s.thread_id,s.timestamp,1);var d=s.id,m=e('.bp-messages-wrap .list .messages-stack .content .messages-list li[data-id="'+d+'"]');m.length>0&&m.find(".message-content").html(s.message)}u(s),Q==s.thread_id?b(s):D?t.length>0&&b(s,a):t.length>0?b(s,a):BP_Messages.user_id==s.user_id||s.fast||f(s.thread_id,s.content_site,s.name,s.avatar)}),"1"==BP_Messages.realtime&&(S.on("delivered",function(s,a){var t=e('.bp-messages-wrap .list .messages-stack .content .messages-list li[data-id="'+s+'"]');t.removeClass("sent"),t.addClass("delivered"),t.find(".status").attr("title",BP_Messages.strings.delivered)}),S.on("seen",function(s,a){var t=e('.bp-messages-wrap .list .messages-stack .content .messages-list li[data-id="'+s+'"]');t.removeClass("delivered sent"),t.addClass("seen"),t.find(".status").attr("title",BP_Messages.strings.seen)})),S.on("writing",function(s){if("object"==typeof s){var a={};e.each(s,function(s){void 0===a[s]&&(a[s]=[]);var t=e('.bp-messages-wrap .thread[data-id="'+s+'"][data-users-json');if(t.length>0){var i=t.attr("data-users-json"),r=e.parseJSON(atob(i));"object"==typeof r&&a[s].push(r[this].name)}}),e.each(a,function(s){e('.bp-messages-wrap .threads-list .thread[data-id="'+s+'"]');if(this.length>0){!function(){var s=e("span.writing"),a=e(".bp-messages-wrap .reply").outerHeight();s.css("bottom",a)}();var a=e('.bp-messages-wrap .thread[data-id="'+s+'"]').parents(".bp-messages-wrap");if(a.hasClass("bp-better-messages-mini"))t=a.find('.chat[data-thread="'+s+'"] span.writing');else var t=a.find("span.writing");t.attr("data-time",Date.now()),t.addClass("shown"),t.html(this.join(", ")+" "+BP_Messages.strings.writing),t.show()}}),e.each(a,function(s){var a=e('.bp-messages-wrap .threads-list .thread[data-id="'+s+'"]');if(a.length>0){var t=a.find(".info p"),i=t.html();void 0===t.attr("writing-reserved")&&t.attr("writing-reserved",i),t.attr("writing-time",Date.now()),a.addClass("bpbm-writing"),t.html('<span class="bpbm-typing">'+BP_Messages.strings.writing+"</span>")}})}}),setInterval(function(){var s=e("span.writing.shown");s.length>0&&s.each(function(){parseInt(e(this).attr("data-time"))+3e3<Date.now()&&e(this).hide().removeClass("shown")});var a=e(".bp-messages-wrap .threads-list .thread.bpbm-writing");a.length>0&&a.each(function(){var s=e(this),a=s.find(".info p");if(parseInt(a.attr("writing-time"))+3e3<Date.now()){var t=a.attr("writing-reserved");a.removeAttr("writing-reserved"),a.removeAttr("writing-time"),a.html(t),s.removeClass("bpbm-writing")}})},1e3);var ee={};T.on("keyup",".reply .bp-emojionearea-editor",function(s){s.stopImmediatePropagation();var a=e(this).closest(".bp-messages-wrap"),t=a.find(".thread[data-id]").data("id");void 0===ee[t]&&(ee[t]=0),s.which<=90&&s.which>=48&&(0===ee[t]||ee[t]+1e3<Date.now())&&(ee[t]=Date.now(),S.emit("writing",t,a.find(".thread[data-users]").attr("data-users")))}),T.on("pointermove",".reply",function(e){e.stopImmediatePropagation()}),T.on("pointerover",".reply",function(e){e.stopImmediatePropagation()}),T.on("keyup",".reply textarea",function(s){s.stopImmediatePropagation();var a=e(this).closest(".bp-messages-wrap"),t=a.find(".thread[data-id]").data("id");void 0===ee[t]&&(ee[t]=0),s.which<=90&&s.which>=48&&(0===ee[t]||ee[t]+1e3<Date.now())&&(ee[t]=Date.now(),S.emit("writing",t,a.find(".thread[data-users]").attr("data-users")))}),"1"==BP_Messages.realtime&&ifvisible.on("wakeup",function(){var s=[],a=[];e(".bp-messages-wrap:not(.bp-better-messages-mini) .list .messages-stack .content .messages-list li.unread:not(.fast),.bp-messages-wrap.bp-better-messages-mini .chat.open .list .messages-stack .content .messages-list li.unread:not(.fast)").each(function(){var t=e(this).data("id"),i=e(this).data("thread"),r=e(this).attr("data-time");s.push(t),a.push(i),e(this).removeClass("unread"),y("bp-better-messages-thread-"+i,r,1)}),s.length>0&&S.emit("seen",s),a=n(a),e.each(a,function(e,s){void 0!==s&&S.emit("threadOpen",s)})})}function n(s){var a=[];return e.each(s,function(s,t){-1===e.inArray(t,a)&&a.push(t)}),a}function o(){function s(s){function a(){if(!0===n)return!1;if(r.next(".bp-emojionearea").length>0){n=!0,i();new BPBM_MediumEditor(".bp-emojionearea-editor",{toolbar:{allowMultiParagraphSelection:!1,buttons:["bold","italic","underline","strikethrough","subscript","superscript","removeFormat"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",relativeContainer:null,standardizeSelectionStart:!1,static:!1,align:"center",sticky:!1,updateOnEmptySelection:!0},placeholder:!1,imageDragging:!1}),e(r).html("<p></p>")}else setTimeout(a,333)}var r=e(s).BPemojioneArea({tones:!0,tonesStyle:"bullet",saveEmojisAs:"unicode",autocomplete:!1,stayFocused:!1,attributes:{dir:t}});if(void 0!==r[0]){r.closest("form").addClass("bp-emoji-enabled");var n=!1;try{r[0].BPemojioneArea.on("onLoad",function(){a()})}catch(e){}setTimeout(a,333)}}function a(s,t){void 0===t&&(t=!1);var i=e(s);if(i.hasClass("loading-more")||i.hasClass("all-loaded"))return!1;i.addClass("loading-more"),i.find(".loading-messages").show();var r=[],n=i.find(".loading-messages");i.find(".threads-list > .thread").each(function(){r.push(e(this).data("id"))});var o={action:"bp_messages_get_more_threads",loaded_threads:r,user_id:BP_Messages.displayed_user_id};i.closest(".bp-messages-wrap").hasClass("bp-better-messages-list")&&(o.user_id=BP_Messages.user_id),e.post(BP_Messages.ajaxUrl,o,function(r){e(r).insertBefore(n),i.removeClass("loading-more"),i.find(".loading-messages").hide(),""===r.trim()?i.addClass("all-loaded"):t&&Math.ceil(s.get(0).scrollHeight)<=Math.ceil(s.innerHeight())&&a(s,!0)})}Q=!1,D=!1,H=!0,clearTimeout(x),"function"==typeof e.fn.mediaelementplayer&&e(".bp-messages-wrap .wp-audio-shortcode, .bp-messages-wrap .wp-video-shortcode").not(".mejs-container").filter(function(){return!e(this).parent().hasClass(".mejs-mediaelement")}).mediaelementplayer(),e(document).trigger("bp-better-messages-update-unread",BP_Messages.total_unread),e(document).trigger("bp-better-messages-reinit-start"),p(),h(),e(".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list) .thread.scroller[data-users-json]").length>0?Q=e(".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list) .thread.scroller[data-users-json]").attr("data-id"):e(".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list,#bp-better-messages-mini-mobile-container) .threads-list").length>0&&(D=!0),x=Q?setTimeout(m,BP_Messages.threadRefresh):setTimeout(d,BP_Messages.siteRefresh),"1"==BP_Messages.miniChats&&e.each(I,function(s){s!==Q?w(s,this):e('.bp-messages-wrap.bp-better-messages-mini .chats .chat[data-thread="'+Q+'"]').remove()}),!1!==U&&(e('.bp-better-messages-list .tabs > div[data-tab="'+U+'"]').addClass("active"),e(".bp-better-messages-list .tabs-content ."+U).addClass("active"));var t="ltr";W&&(t="rtl");if("1"===BP_Messages.mobileEmojiEnable||!F&&!e("body").hasClass("bp-messages-mobile")){s(r=".bp-messages-wrap .reply .message textarea, .bp-messages-wrap .new-message #message-input, .bp-messages-wrap .bulk-message #message-input")}else{var r=".bp-better-messages-mini .chats .chat .reply .message textarea";s(r),e.fn.BPBMloadEmojione(123),i()}"function"==typeof e.fn.BPBMoverlayScrollbars&&(jQuery(".bp-better-messages-list .tabs-content .friends .scroller,.scroller.search, .scroller.starred").BPBMoverlayScrollbars({sizeAutoCapable:!1}),jQuery(".bpbm-stickers-selector .bpbm-stickers-head .bpbm-stickers-tabs").BPBMoverlayScrollbars({sizeAutoCapable:!1,overflowBehavior:{y:"hidden"}}),jQuery(".scroller.thread").BPBMoverlayScrollbars({sizeAutoCapable:!1,callbacks:{onInitialized:function(){var s=this.getElements(),a=this.scroll().max.y,t=!1;if(k("message_id").length>0){var i=k("message_id"),r=e(s.content).find(".messages-list li[data-id='"+i+"']");r.length>0&&(t=r)}!1!==t?(jQuery(this.getElements().host).addClass("user-scrolled"),this.scroll({el:t,scroll:"ifneeded",margin:20})):jQuery(s.host).is(":visible")&&0===a?l(this,!0):this.scroll({y:"100%"})},onScroll:function(e){var s=this.scroll(),a=s.position.y;0===s.max.y?l(this,!0):jQuery(this.getElements().host).hasClass("user-scrolled")?0===a&&l(this):this.scroll({y:"100%"},0)},onContentSizeChanged:function(e){var s=this.getElements(),a=this.scroll(),t=a.max.y,i=a.position.y,r=jQuery(s.host),n=jQuery(s.content).find(".list .messages-stack:last .content .messages-list li:last").outerHeight();n<100&&(n=100),(!r.hasClass("user-scrolled")||t-i<n+50)&&this.scroll({y:"100%"},100)}}}),jQuery(".scroller.threads-list-wrapper").BPBMoverlayScrollbars({sizeAutoCapable:!1,callbacks:{onInitialized:function(){},onScroll:function(e){var s=this.getElements(),t=this.scroll(),i=t.position.y,r=t.max.y,n=jQuery(s.host);r-i<=100&&a(n)},onContentSizeChanged:function(e){}}}));var o=jQuery(".bp-messages-wrap:not(.bp-better-messages-list,.bp-better-messages-mini) .scroll-wrapper .scrollbar-inner.scroll-content.threads-list-wrapper");if(0===o.length&&(o=jQuery(".bp-messages-wrap:not(.bp-better-messages-list,.bp-better-messages-mini) .scroller.scrollbar-inner.threads-list-wrapper")),o.length>0&&(Math.ceil(o.get(0).scrollHeight),Math.ceil(o.innerHeight())),jQuery(".scrollbar-inner").on("touchstart click mousewheel DOMMouseScroll",function(){e(this).addClass("user-scrolled")}),"function"==typeof e.fn.BPBMmagnificPopup&&e(".bp-messages-wrap .list .messages-stack .content .messages-list li .images").BPBMmagnificPopup({delegate:"a",type:"image"}),"1"==BP_Messages.realtime){var c=[],g=[];e(".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list) .list .messages-stack .content .messages-list li:not(.seen), .bp-messages-wrap.bp-better-messages-mini .chat.open .list .messages-stack .content .messages-list li:not(.seen)").each(function(){var s=e(this).data("id"),a=e(this).data("thread");c.push(s),g.push(a)}),S.emit("getStatuses",c,function(s){var a={};e.each(c,function(){a[this]=!0}),e.each(s,function(s){delete a[s];var t=e('.bp-messages-wrap .list .messages-stack .content .messages-list li[data-id="'+s+'"]');if(t.removeClass("sent delivered seen"),t.hasClass("my")||t.hasClass("fast")){var i="sent";e.each(this,function(){if("seen"==i)return!1;"delivered"==this&&"seen"!=i&&(i="delivered"),"seen"==this&&(i="seen")}),t.addClass(i);var r="";switch(i){case"sent":r=BP_Messages.strings.sent;break;case"delivered":r=BP_Messages.strings.delivered;break;case"seen":r=BP_Messages.strings.seen}t.find(".status").attr("title",r)}else"seen"!==this.toString()&&S.emit("seen",[s])}),e.each(a,function(s){var a=e('.bp-messages-wrap .list .messages-stack .content .messages-list li[data-id="'+s+'"]');a.removeClass("sent delivered seen"),a.addClass("seen"),a.find(".status").attr("title",BP_Messages.strings.seen)})}),Q&&S.emit("threadOpen",Q),g=n(g),e.each(g,function(e,s){void 0!==s&&S.emit("threadOpen",s)}),S.emit("requestUnread")}if(i(),e(window).on("resize",function(){i()}),e(".bp-messages-wrap #send-to:not(.ready)").length>0){var u=[],b=new Taggle("send-to",{placeholder:"",tabIndex:2,hiddenInputName:"recipients[]"}),f=b.getContainer(),v=b.getInput(),_=e('input[name="to"]');_.length>0&&e(_).each(function(){var s=e(this).data("img"),a=e(this).data("label");b.add(e(this).val()),e(f).find(".taggle_sizer").text(""),e("#send-to li.taggle:last .taggle_text").html('<span class="bpbm-avatar"><img src="'+s+'" class="avatar photo" width="50" height="50"></span><span class="bpbm-name">'+a+"</span>"),e(this).remove()}),e(v).on("blur",function(s){var a=e(f).find(".taggle_sizer").text();b.add(a)}),e(v).autocomplete({source:function(s,a){var t=s.term;t in u?a(u[t]):e.getJSON(BP_Messages.ajaxUrl+"?q="+t+"&limit=10&action=bp_messages_autocomplete&cookie="+function(){var e,s,a,t,i,r=document.cookie.split(";"),n={};for(e=0;e<r.length;e++)s=r[e],a=s.indexOf("="),t=jQuery.trim(unescape(s.slice(0,a))),i=unescape(s.slice(a+1)),0===t.indexOf("bp-")&&(n[t]=i);return encodeURIComponent(jQuery.param(n))}(),s,function(e,s,i){u[t]=e,a(e)})},minLength:2,appendTo:f,position:{at:"left bottom",of:f},open:function(s,a){var t=e(".bp-messages-wrap #send-to .ui-autocomplete"),i=parseInt(t.css("top"))-3;t.css("top",i)},select:function(s,a){s.preventDefault(),1===s.which&&(b.add(a.item.value),e(f).find(".taggle_sizer").text(""),e("#send-to li.taggle:last .taggle_text").html('<span class="bpbm-avatar">'+a.item.img+'</span><span class="bpbm-name">'+a.item.label+"</span>"))},response:function(s,a){e(".ui-helper-hidden-accessible").hide()}}).autocomplete("instance")._renderItem=function(s,a){return e("<li>").attr("data-value",a.value).attr("data-label",a.label).append('<span class="bpbm-avatar">'+a.img+'</span><span class="bpbm-name">'+a.label+"</span>").appendTo(s)},e("#send-to").addClass("ready")}T.find(".bp-messages-mobile-tap").css("line-height",T.height()+"px"),e(".bp-messages-side-threads .threads-list .thread.bp-messages-active-thread").removeClass("bp-messages-active-thread"),Q&&e('.bp-messages-side-threads .threads-list .thread[data-id="'+Q+'"]').addClass("bp-messages-active-thread"),e(document.body).trigger("post-load"),"1"===BP_Messages.enablePushNotifications&&e(".BPBMpushNotifications").length>0&&BPBMcheckPushWorkerStatus(),C(T),H=!1}function l(s,a){void 0===a&&(a=!1);var t=s.getElements(),i=jQuery(t.host);if(i.hasClass("loadingAtTheMoment")||i.hasClass("allMessagesWasLoaded"))return!1;var r=i.data("id");i.find(".loading-messages").show(),i.addClass("loadingAtTheMoment");var n=i.find(".messages-stack:first-child .messages-list li:first-child"),c=n.attr("data-id");e.post(BP_Messages.ajaxUrl,{action:"bp_messages_thread_load_messages",thread_id:r,message_id:c},function(t){i.find(".loading-messages").hide(),""===t.trim()&&i.addClass("allMessagesWasLoaded"),e(t).prependTo(i.find(".list")),i.addClass("hasLoadedMessages"),s.scroll({el:n.closest(".messages-stack"),margin:15}),o(),i.removeClass("loadingAtTheMoment"),a&&0===s.scroll().max.y&&l(s,!0)})}function c(s){if(void 0===s&&(s=".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list)"),0!=e(s+" .list").length){var a=e(s+" .scroller[data-id]"),t=a.data("id");if(void 0!==O[t])return!1;var i=e(s+" .list"),r=i[0].offsetHeight;if(k("message_id").length>0){var n=k("message_id"),o=e(s+" .messages-list li[data-id='"+n+"']");o.length>0&&(r=o[0].offsetTop-o[0].offsetHeight-100)}var l=i.closest(".scroller"),c=l.hasClass("user-scrolled"),d=l[0].scrollHeight-l.scrollTop()-l.height();if(!(r<l.outerHeight())&&(!c||100>=d)){var m=a.BPBMoverlayScrollbars();void 0!==m&&(m.update(),m.scroll({y:"100%"}))}}}function d(){if(clearInterval(x),x=setTimeout(d,BP_Messages.siteRefresh),"1"!=BP_Messages.realtime&&!Y){var s=M("bp-messages-last-check");Y=!0,e.post(BP_Messages.ajaxUrl,{action:"bp_messages_check_new",last_check:s},function(s){s.threads.length>0&&e.each(s.threads,function(){D?u(this):f(this.thread_id,this.message,this.name,this.avatar)}),e(document).trigger("bp-better-messages-update-unread",s.total_unread),Y=!1})}}function m(){if(clearInterval(x),x=setTimeout(m,BP_Messages.threadRefresh),"1"!=BP_Messages.realtime&&!V){var s=M("bp-messages-last-check"),a=e(".messages-stack:last-child .messages-list li:last-child").attr("data-time");V=!0,e.post(BP_Messages.ajaxUrl,{action:"bp_messages_thread_check_new",last_check:s,thread_id:Q,last_message:a},function(s){e.each(s.messages,function(){b(this)}),e.each(s.threads,function(){f(this.thread_id,this.message,this.name,this.avatar)}),e(document).trigger("bp-better-messages-update-unread",s.total_unread),V=!1})}}function p(){if(!store.enabled)return!1;E=store.get("bp-better-messages-open-threads")||{},!1!==Q&&(E[Q]=Date.now()),e.each(E,function(e){this+2e3<Date.now()&&delete E[e]}),store.set("bp-better-messages-open-threads",E)}function g(s,a){if(void 0===a){var t=jQuery(event.target);a=t.hasClass("bp-messages-wrap")?t:t.closest(".bp-messages-wrap")}if(q){if(!1===confirm(BP_Messages.strings.you_are_in_call))return!1;jQuery(document).trigger("bpbm-end-call")}if(a.hasClass("bp-messages-wrap-main"))try{window.history.pushState("","",s)}catch(e){}a.find(".preloader").show(),e(window).off(".bp-messages");var i="?action=bp_messages_load_via_ajax";void 0!==s.split("?")[1]&&(i="?"+s.split("?")[1]+"&action=bp_messages_load_via_ajax");var r=a.find(".bp-messages-side-threads-wrapper"),n=BP_Messages.ajaxUrl+i;r.length>0&&(n+="&ignore_threads"),e.ajax({method:"GET",url:n,cache:!1,success:function(s){var t=(s=e(s)).find(".bp-messages-side-threads-wrapper");if(r.length>0&&t.length>0)a.find(".bp-messages-side-threads-wrapper .bp-messages-column").html(s.find(".bp-messages-side-threads-wrapper .bp-messages-column").html()),a.find(".bp-messages-side-threads-wrapper").closest(".bp-messages-wrap").find(".chat-header").html(s.find(".bp-messages-side-threads-wrapper").closest(".bp-messages-wrap").find(".chat-header").html());else{var i=s.html();a.html(i)}a.hasClass("bp-messages-wrap-main")&&a.attr("data-thread-id",s.attr("data-thread-id")),a.is("#bp-better-messages-mini-mobile-container")&&a.attr("data-thread",s.attr("data-thread-id")),o()}})}function h(){e(".bp-messages-wrap img.avatar[data-user-id]").each(function(){var s=e(this).attr("data-user-id"),a=!1;if(e(this).parent().hasClass("bbpm-avatar")&&(a=e(this).parent()),!a){var t=e(this).height(),i=e(this).height(),r=e(this).css("marginTop"),n=e(this).css("marginLeft"),o=e(this).css("marginBottom"),l=e(this).css("marginRight");e(this).css({marginTop:0,marginLeft:0,marginRight:0,marginBottom:0}),e(this).wrap('<span class="avatar bbpm-avatar" data-user-id="'+s+'"></span>'),(a=e(this).parent()).css({marginTop:r,marginLeft:n,marginRight:l,marginBottom:o,width:t,height:i})}A.indexOf(s)>-1?e(a).addClass("online"):e(a).removeClass("online")})}function u(s){if(s.fast||"1"==s.edit)return!1;e(".bp-messages-wrap .threads-list .empty").remove();var a=s.thread_id,t=s.html;t=t.replace('loading="lazy"',"");var i=e(".bp-messages-wrap .threads-list .thread[data-id='"+a+"']");if(i.length>0){var r=s.content_site;i.each(function(){var a=e(this),t=a.closest(".threads-list");a.find(".info p").html(r),a.attr("data-message",s.id),a.prependTo(t)})}else e(t).prependTo(".bp-messages-wrap .threads-list");void 0===BP_Messages.mutedThreads[a]&&BP_Messages.user_id!=s.user_id&&(void 0!==s.count_unread?"0"!==s.count_unread&&P(s.id):P(s.id)),h()}function b(s,a){var t=!1,i=!1;if(void 0===a&&(a=".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list)"),""==s.message.trim())return!1;var r="1"==s.edit;"1"!=BP_Messages.realtime||s.fast||(r?(t=!0,s.temp_id=s.id):s.temp_id&&(t=!0));var n=moment(b).format("YYYY-MM-DD HH:mm:ss").toString(),o=e(a+" .messages-stack:last-child");0===o.length&&e(a+" .empty-thread").length>0&&(i=!0);var l=e(a+' .messages-list li[data-id="'+s.id+'"]'),c="";e("body").hasClass("bp-messages-mobile")&&parseInt(s.thread_id)===parseInt(Q)||ifvisible.now("active")||"1"!=BP_Messages.realtime||s.user_id===BP_Messages.user_id||(c+=" unread"),s.user_id==BP_Messages.user_id&&(c+=" my"),s.fast&&(c+=" fast"),s.user_id==BP_Messages.user_id&&"1"==BP_Messages.realtime&&(c+=" sent"),c=c.trim();var d=e(a+' .messages-list li[data-id="'+s.temp_id+'"]');r&&d.length>0&&(c=d.attr("class"));var m='<li class="'+c+'" data-thread="'+s.thread_id+'" title="'+n+'" data-time="'+s.timestamp+'" data-id="'+s.id+'"><span class="favorite"><i class="fas" aria-hidden="true"></i></span>';if(s.user_id==BP_Messages.user_id&&(m+='<span class="status" title="'+BP_Messages.strings.sent+'"></span>'),m+='<span class="message-content">'+s.message+"</span></li>",t&&d.length>0)return s.message!==d.find(".message-content").html()?d.replaceWith(m):(d.attr("data-id",s.id),d.removeClass("fast")),!0;if(0===l.length&&(o.length>0||i)){1==i&&e(a+" .empty-thread").remove();var p=!0,g=new Date(1e3*o.find(".messages-list > li:last-child").attr("data-time")),u=g.getFullYear()+"-"+g.getMonth()+"-"+g.getDate()+"-"+g.getHours()+"-"+g.getMinutes(),b=new Date(1e3*s.timestamp),f=b.getFullYear()+"-"+b.getMonth()+"-"+b.getDate()+"-"+b.getHours()+"-"+b.getMinutes();if(o.attr("data-user-id")===s.user_id&&(p=!1),u!==f&&(p=!0),!1===p)o.find(".messages-list").append(m);else{var v="messages-stack";s.user_id==BP_Messages.user_id?v+=" outgoing":v+=" incoming";var _='<div class="'+v+'" data-user-id="'+s.user_id+'"><div class="pic">'+s.avatar+'</div><div class="content"><div class="info"><div class="name"><a href="'+s.link+'">'+s.name+'</a></div><div class="time" title="'+n+'" data-livestamp="'+s.timestamp+'"></div></div><ul class="messages-list"></ul></div></div>';e(a+" .list").append(_),e(a+" .messages-stack:last-child .messages-list").append(m)}e(a+" .wp-audio-shortcode, "+a+" .wp-video-shortcode").not(".mejs-container").filter(function(){return!e(this).parent().hasClass(".mejs-mediaelement")}).mediaelementplayer(),"function"==typeof e.fn.BPBMmagnificPopup&&e(".bp-messages-wrap .list .messages-stack .content .messages-list li .images").BPBMmagnificPopup({delegate:"a",type:"image"}),void 0===BP_Messages.mutedThreads[s.thread_id]&&BP_Messages.user_id!=s.user_id&&(void 0!==s.count_unread?"0"!==s.count_unread&&P(s.id):P(s.id))}h()}function f(s,a,t,i){if(void 0===E[s]&&void 0===BP_Messages.mutedThreads[s]&&!e("body").hasClass("bp-messages-mobile")){var r=i.match(/src\="([^\s]*)"\s/),n=i.match(/src\='([^\s]*)'\s/);null!=r&&(i=r[1]),null!=n&&(i=n[1]);var o=e(".amaran.thread_"+s);if(o.length>0){o.find(".icon > img").attr("src",i);var l="<b>"+t+"</b>";return l+=a,o.find(".info").html(l),!0}"1"==BP_Messages.miniMessages&&"messages"===U||e.amaran({theme:"user message thread_"+s,content:{img:i,user:t,message:a},sticky:!0,closeOnClick:!1,closeButton:!0,delay:1e4,thread_id:s,position:"bottom right",onClick:function(){if("1"!=BP_Messages.realtime||"1"!=BP_Messages.miniChats||F)if(F){var a=e("#bp-better-messages-mini-mobile-open");if(a.length>0){var t=BP_Messages.url;BP_Messages.url=BP_Messages.threadUrl+this.thread_id,a.click(),BP_Messages.url=t,e(".amaran.user.message.thread_"+s).remove()}else location.href=BP_Messages.threadUrl+this.thread_id}else location.href=BP_Messages.threadUrl+this.thread_id;else w(this.thread_id,!0),e(".amaran.user.message.thread_"+s).remove()}}),void 0!==a.count_unread?"0"!==a.count_unread&&P(a.id):P(a.id)}}function v(){e("*:not(.bp-messages-hide-on-mobile)").filter(function(){return("fixed"===e(this).css("position")||"absolute"===e(this).css("position"))&&!e(this).hasClass("bp-messages-wrap")&&0===e(this).closest(".uppy").length&&0===e(this).closest(".bp-messages-wrap").length}).addClass("bp-messages-hide-on-mobile")}function _(s){var a=new e.Deferred;return e.post(BP_Messages.ajaxUrl,{action:"bp_messages_get_pm_thread",user_id:s},function(e){if(F&&"1"===BP_Messages.mobileFullScreen)BP_Messages.threadUrl;else w(e,!0).always(function(e){a.resolve(!0)})}),a.promise()}function w(s,a){var t=new e.Deferred;if("1"!=BP_Messages.miniChats||G.indexOf(s)>-1)t.reject(!1);else{var i=e('.bp-messages-wrap.bp-better-messages-mini .chats .chat[data-thread="'+s+'"]');if(i.length>0){if(!H){var r=i.find(".head");i.addClass("open"),i.removeClass("blink");var n=0,l=setInterval(function(){r.toggleClass("blink"),++n>=6&&clearInterval(l)},500)}t.reject(!1)}else{G.push(s);var c="?action=bp_messages_load_via_ajax&thread_id="+s+"&mini=1",d=BP_Messages.ajaxUrl+c;e.ajax({method:"GET",url:d,cache:!1,success:function(i){var r=e(i),n=r.find(".chat-header").html().trim();r.find(".chat-header, .preloader").remove();var l="chat";1==a&&(l+=" open");var c='<div class="'+l+'" data-thread="'+s+'" style="visibility: hidden">';c+='<div class="head"><span class="unread-count count-0"></span><span class="title">'+n+"</span>",c+='<div class="controls">\n<span class="open"><i class="fas fa-window-maximize" aria-hidden="true"></i></span>\n<span class="close"><i class="fas fa-times" aria-hidden="true"></i></span>\n</div></div>',c+=r.html(),e(c+="</div>").appendTo(".bp-messages-wrap.bp-better-messages-mini .chats"),I[s]=a,store.set("bp-better-messages-mini-chats",I),delete G[G.indexOf(s)],o(),!0===a&&S.emit("threadOpen",s),clearTimeout(K),K=setTimeout(function(){e(".bp-messages-wrap.bp-better-messages-mini .chats .chat").each(function(){var s=e(this).data("thread");parseInt(e(".bp-messages-wrap.bp-better-messages-mini").outerHeight())-parseInt(e(this).position().top+e(this).outerHeight())>1&&(e(this).remove(),void 0!==I[s]&&delete I[s],store.set("bp-better-messages-mini-chats",I))}),e(".bp-messages-wrap.bp-better-messages-mini .chats .chat").css("visibility","visible")},100),t.resolve(!0)},statusCode:{403:function(){delete I[s],store.set("bp-better-messages-mini-chats",I)}}})}}return t.promise()}function B(s,a){var t;a<1?(t="",e('.threads-list .thread[data-id="'+s+'"], .bp-better-messages-mini .chat[data-thread="'+s+'"]').removeClass("unread"),e('.bp-messages-wrap .messages-list li[data-thread="'+s+'"]').removeClass("unread")):(t="+"+a,e('.threads-list .thread[data-id="'+s+'"], .bp-better-messages-mini .chat[data-thread="'+s+'"]').addClass("unread")),e('.threads-list .thread[data-id="'+s+'"] .time .unread-count').text(t),e('.bp-better-messages-mini .chat[data-thread="'+s+'"] .unread-count').attr("class","unread-count count-"+a).text(a)}function P(e){"string"==typeof e&&"tmp_"!==e.substr(0,4)&&ion.sound.play("notification")}function y(e,s,a){if(a){var t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3);i="; expires="+t.toUTCString()}else var i="";document.cookie=e+"="+s+i+"; path=/"}function M(e){for(var s=e+"=",a=document.cookie.split(";"),t=0;t<a.length;t++){for(var i=a[t];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(s))return i.substring(s.length,i.length)}return null}function k(e){var s="[\\?&]"+(e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"))+"=([^&#]*)",a=new RegExp(s).exec(window.location.search);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))}function j(e){parseInt(e%1e3/100);var s=Math.floor(e/1e3%60),a=Math.floor(e/6e4%60),t=Math.floor(e/36e5%24);return t=t<10?"0"+t:t,a=a<10?"0"+a:a,s=s<10?"0"+s:s,"00"!==t?t+":"+a+":"+s:a+":"+s}function C(s){var a=s.find(".chat-header"),t=a.find("> strong"),i=a.find("> .user"),r=0;a.find("> a:visible:not(.user)").each(function(){r+=e(this).width()});var n=r+10;t.length>0&&t.css("width","calc(100% - "+n+"px)"),i.length>0&&i.css("max-width","calc(100% - "+n+"px)")}var x,Q,S,D,T,E={},I={},U=!1,A=[],O={},N={},H=!1,z=!1,W=0!==e('html[dir="rtl"]').length,R=window.RTCPeerConnection||window.webkitRTCPeerConnection,L=window.mozRTCSessionDescription||window.RTCSessionDescription,q=!1;ifvisible.setIdleDuration(3),e.fn.BPBMremoveAttributes=function(){return this.each(function(){var s=e.map(this.attributes,function(e){return e.name}),a=e(this);e.each(s,function(e,s){a.removeAttr(s)})})},e(window).on("focus",function(){ifvisible.focus()}),e(window).on("blur",function(){ifvisible.blur()});var F=!1;(/iPad|iPhone|iPod/.test(navigator.userAgent)||/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(F=!0),"0"===BP_Messages.mobileFullScreen&&(F=!1),"1"===BP_Messages.forceMobile&&(F=!0);var J="bp-better-messages-mobile-holder";e(document).ready(function(){function n(){if(h)return!1;var s=window.innerHeight,a=0;a+=T.find(".chat-header").outerHeight(),a+=T.find(".reply").outerHeight(),e(".scroller").css({"max-height":"",height:s-a})}W=0!==e('html[dir="rtl"]').length,T=e(".bp-messages-wrap:not(.bp-better-messages-list, #bp-better-messages-mini-mobile-open)");var l=e("#bp-better-messages-mini-mobile-container"),d=e("#bp-better-messages-mini-mobile-open");if(F||d.hide(),ion.sound({sounds:[{name:"calling"},{name:"notification"}],path:BP_Messages.assets,preload:!0,multiplay:!0,volume:.75}),F){var h=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;e(document).on("touchmove",".bp-messages-wrap .chat-header,.bp-messages-wrap .reply",function(e){z&&e.preventDefault()}),e(document).on("focus blur",".bp-messages-wrap textarea, .bp-messages-wrap input",function(e){setTimeout(function(){n(),c()},300)}),e(window).resize(function(){T.hasClass("bp-messages-mobile")&&n()}),T.addClass("mobile-ready");var u,b=!1;"0"===BP_Messages.disableTapToOpen?(T.find(".bp-messages-mobile-tap").css("line-height",T.height()+"px"),T.on("touchend",".bp-messages-mobile-tap",function(e){if(1!=u&&!1===b){var s=jQuery(e.target).closest(".bp-messages-wrap");s.hasClass("bp-messages-mobile")||(e.preventDefault(),e.stopImmediatePropagation(),a(s))}}).on("touchmove",function(e){u=!0}).on("touchstart",function(e){u=!1})):T.on("touchend",function(s){if(1!=u&&!1===b){var t=jQuery(s.target).closest(".bp-messages-wrap");if(!t.hasClass("bp-messages-mobile")){s.preventDefault(),s.stopImmediatePropagation(),a(t);var i=e(s.originalEvent.target).closest(".thread");i.length>0&&i.click()}}}).on("touchmove",function(e){u=!0}).on("touchstart",function(e){u=!1})}e(document).on("click",".bp-messages-wrap .mobileClose",function(s){var a=jQuery(s.target).closest(".bp-messages-wrap");if(a.hasClass("bp-messages-mobile")){s.preventDefault(),s.stopImmediatePropagation(),b=!0,e("html").removeClass("bp-messages-mobile").css("overflow","auto"),a.removeClass("bp-messages-mobile").css("min-height",""),e("body").removeClass("bp-messages-mobile").css("min-height","");var t=e(window).height()-250;if(t>BP_Messages.max_height&&(t=BP_Messages.max_height),e(".scroller").css({"max-height":t,height:""}),z=!1,a.find(".bp-messages-mobile-tap").css("line-height",a.height()+"px"),a.is(l)&&l.hide(),a.is("#bp-better-messages-mobile-view-container")){var i=a;i.removeClass("bp-messages-mobile"),i.removeAttr("id");var r=e("."+J);i.insertBefore(r),r.remove()}e(window).trigger("resize"),setTimeout(function(){b=!1},100)}}),d.on("click",function(s){s.preventDefault(),d.hasClass("loading")||(d.addClass("loading"),function(s){var a=e("#bp-better-messages-mini-mobile-container");a.addClass("bp-messages-mobile"),a.find(".bp-messages-mobile-tap").remove();var t=window.innerHeight;e("html").addClass("bp-messages-mobile").css("overflow","hidden"),e("body").addClass("bp-messages-mobile").css("min-height",t),T.addClass("bp-messages-mobile").css("min-height",t);var i=0;i+=T.find(".chat-header").outerHeight();var r=t-(i+=T.find(".reply").outerHeight());e(".scroller").css({"max-height":"",height:r}),v(),a.show().html('<div class="loading-messages" style="display: block;line-height: '+r+'px">\n<div class="bounce1"></div>\n<div class="bounce2"></div>\n<div class="bounce3"></div>\n</div>');var n="?action=bp_messages_load_via_ajax";void 0!==s.split("?")[1]&&(n="?"+s.split("?")[1]+"&action=bp_messages_load_via_ajax");var l=BP_Messages.ajaxUrl+n;e.get(l,function(s){var t=e(s).filter(".bp-messages-wrap").html();a.html(t).show(),z=!0,o(),e("#bp-better-messages-mini-mobile-open").removeClass("loading")})}(BP_Messages.baseUrl))});var f=!1,B=!1;if(e(".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list) .thread.scroller[data-users-json]").length>0?f=e(".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list) .thread.scroller[data-users-json]").attr("data-id"):e(".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list,#bp-better-messages-mini-mobile-container) .threads-list").length>0&&(B=!0),F&&"1"===BP_Messages.autoFullScreen)if(f||B){e("#bp-better-messages-mini-mobile-open, #bp-better-messages-mini-mobile-container").remove();a(P=e(".bp-messages-wrap.mobile-ready.bp-messages-wrap-main"))}else{var P=e(".bp-messages-wrap.bp-messages-wrap-bulk.mobile-ready");P.length>0&&a(P)}"1"===BP_Messages.blockScroll&&e(".bp-messages-wrap").on("mousewheel DOMMouseScroll",".scroll-content",function(s){var a=s.originalEvent,t=a.wheelDelta||-a.detail,i=s.currentTarget.scrollHeight-e(s.currentTarget).height();this.scrollTop+=5*(t<0?1:-1),(this.scrollTop<5||i-this.scrollTop<5)&&s.preventDefault()}),store.enabled&&(E=store.get("bp-better-messages-open-threads")||{},I=store.get("bp-better-messages-mini-chats")||{},U=store.get("bp-better-messages-mini-messages")||!1,setInterval(p,1e3)),"1"==BP_Messages.realtime&&r(),o(),void 0===BP_Messages.socket_server&&setInterval(function(){e.post(BP_Messages.ajaxUrl,{action:"bp_messages_last_activity_refresh"})},3e5),T.on("click",".threads-list .thread:not(.blocked)",function(s){if(0===e(s.target).closest(".pic").length&&0===e(s.target).closest(".delete").length&&0===e(s.target).closest(".deleted").length){s.preventDefault();g(e(this).attr("data-href"),e(this).closest(".bp-messages-wrap"))}}),e(document).on("click",".bp-messages-wrap .threads-list .thread span.delete",function(s){s.preventDefault(),s.stopPropagation();var a=e(this).parent().parent(),t=(a.parent().parent(),e(a).attr("data-id")),i=e(a).height(),r=e(this).attr("data-nonce");e.post(BP_Messages.ajaxUrl,{action:"bp_messages_delete_thread",thread_id:t,nonce:r},function(s){if(s.result){var t=a.position().top;e(a).addClass("blocked"),e(a).find(".deleted").show().css({height:i,"line-height":i+"px",top:t+"px"})}else BBPMShowError(s.errors[0])})}),e(document).on("click",".bp-messages-wrap .threads-list .thread a.undelete",function(s){s.preventDefault(),s.stopPropagation();var a=e(this).parent().parent(),t=e(a).attr("data-id");e(a).removeClass("blocked");var i=e(this).attr("data-nonce");e.post(BP_Messages.ajaxUrl,{action:"bp_messages_un_delete_thread",thread_id:t,nonce:i},function(s){s.result?(e(a).removeClass("blocked"),e(a).find(".deleted").hide()):BBPMShowError(s.errors[0])})}),T.on("click",".messages-list li .favorite",function(s){s.preventDefault(),s.stopPropagation();var a=e(this).parentsUntil(".messages-list","li").attr("data-id"),t="star";e(this).hasClass("active")&&(t="unstar"),e(this).toggleClass("active"),e.post(BP_Messages.ajaxUrl,{action:"bp_messages_favorite",message_id:a,thread_id:Q,type:t},function(e){})});var M,k=!1,j="";T.on("submit",".reply > form",function(a){if(a.preventDefault(),a.stopPropagation(),!0!==k){var t=e(this);if(t.serialize()===j)return!1;var i=s(e(this).find('textarea[name="message"]')),r=e(this).serialize(),n=Q,o=e(this).find('input[name="message_id"]').val().trim().length>0,l=e(this).parent().parent().find(".thread.scroller[data-users-json]"),c=atob(l.attr("data-users-json")),d=e.parseJSON(c);if(e(this).parent().parent().hasClass("chat open")&&(n=e(this).parent().parent().attr("data-thread")),"1"===BP_Messages.encryption){var p=l.data("secret");i=BPBMAES256.encrypt(i,p),e.each(d,function(e,s){d[e].avatar=BPBMAES256.encrypt(s.avatar,p),d[e].link=BPBMAES256.encrypt(s.link,p),d[e].name=BPBMAES256.encrypt(s.name,p)})}n&&"1"==BP_Messages.realtime&&!o?S.emit("message",n,i,d,function(s){j=r,clearInterval(M),M=setInterval(function(){j=""},3e3),e(document).trigger("bp-better-messages-message-sent"),t.find('input[name="message_id"]').val(""),r+="&tempID="+s,e.post(BP_Messages.ajaxUrl,r,function(s){if(void 0!==s.result&&(e.each(s.errors,function(){BBPMShowError(this)}),void 0!==s.redirect&&"refresh"===s.redirect)){t.closest(".bp-messages-wrap").hasClass("bp-better-messages-mini")?(e('.bp-better-messages-mini .chats .chat[data-thread="'+n+'"]').remove(),w(n,!0)):g(location.href,t.closest(".bp-messages-wrap"))}}).always(function(){k=!1})}):e.post(BP_Messages.ajaxUrl,r,function(s){void 0!==s.result&&(s.result?(m(),e(document).trigger("bp-better-messages-message-sent"),j=r,clearInterval(M),M=setInterval(function(){j=""},3e3),t.find('input[name="message_id"]').val("")):(e.each(s.errors,function(){BBPMShowError(this)}),void 0!==s.redirect&&"refresh"===s.redirect&&g(location.href,t.closest(".bp-messages-wrap"))))}).always(function(){k=!1}),e(this).find("textarea, .bp-emojionearea-editor").html("").val("")}}),T.on("click ",".bpbm-stickers-selector .bpbm-stickers-selector-sticker",function(s){s.preventDefault(),s.stopPropagation();var a=e(this),t=a.closest(".bpbm-stickers-selector"),r=t.parent().find(".reply form"),n=a.data("sticker-id"),o=a.find("img").attr("src"),l=r.find('input[name="thread_id"]').val(),c=r.find('input[name="_wpnonce"]').val();t.hide(),i(),e.post(BP_Messages.ajaxUrl,{action:"bpbm_messages_send_sticker",thread_id:l,sticker_id:n,sticker_img:o,_wpnonce:c},function(e){})}),T.on("click touchstart",".reply .bpbm-stickers-btn",function(s){s.preventDefault(),s.stopPropagation();var a=e(this).closest(".reply"),t=a.parent(),i=a.find("form").find("textarea"),r=t.find(".bpbm-stickers-selector");i.blur(),r.is(":visible")||r.show()}),T.on("click",".bpbm-stickers-selector .bpbm-stickers-close",function(s){s.preventDefault(),s.stopPropagation();var a=e(this).closest(".bpbm-stickers-selector");a.parent().find(".reply form");a.hide()}),T.on("click",".bpbm-stickers-selector .bpbm-stickers-head .bpbm-stickers-tabs span",function(s){s.preventDefault(),s.stopPropagation();var a=e(this),t=a.closest(".bpbm-stickers-selector"),i=t.find(".bpbm-stickers-selector-sticker-container");t.find(".bpbm-stickers-tabs span").removeClass("bpbm-stickers-tabs-active"),a.addClass("bpbm-stickers-tabs-active"),i.html('<div class="loading-messages"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');var r=a.data("package-id");e.post(BP_Messages.ajaxUrl,{action:"bpbm_messages_get_sticker_tab",package:r},function(e){i.html(e)})});var C;if(T.on("keyup change",".bpbm-stickers-selector .bpbm-stickers-search input",function(s){s.preventDefault(),s.stopPropagation();var a=e(this),t=a.closest(".bpbm-stickers-search"),i=a.closest(".bpbm-stickers-selector"),r=i.find(".bpbm-stickers-selector-sticker-list"),n=t.data("search-term"),o=a.val();n!==o&&(t.data("search-term",o),C&&C.abort(),C=e.post(BP_Messages.ajaxUrl,{action:"bpbm_messages_search_stickers",search:o},function(s){r.replaceWith(s),(r=i.find(".bpbm-stickers-selector-sticker-list")).BPBMoverlayScrollbars({sizeAutoCapable:!1,callbacks:{onScroll:function(s){var a=this.scroll(),t=a.position.y;if(a.max.y-t<=10){var i=this.getElements(),r=jQuery(i.host);if(!r.hasClass("bpbm-loading-stickers")){var n=r.data("pages"),l=r.data("pages-loaded")+1;l<=n&&(r.addClass("bpbm-loading-stickers"),e.post(BP_Messages.ajaxUrl,{action:"bpbm_messages_search_stickers",search:o,page:l},function(s){r.data("pages-loaded",l),e(s).appendTo(jQuery(i.content)),r.removeClass("bpbm-loading-stickers")}))}}}}})}))}),T.on("submit",".new-message form",function(a){a.preventDefault(),a.stopPropagation();var t=jQuery(a.target).closest(".bp-messages-wrap");e(".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list) .preloader").show();s(e(this).find('textarea[name="message"]'));var i=e(this).serialize();e.post(BP_Messages.ajaxUrl,i,function(s){s.result?g(BP_Messages.threadUrl+s.result,t):(e(".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list) .preloader").hide(),e.each(s.errors,function(){BBPMShowError(this)}))})}),T.on("click","a.ajax",function(s){s.preventDefault(),s.stopPropagation();g(e(this).attr("href"),e(this).closest(".bp-messages-wrap"))}),T.on("click",".bpbm-search a.search",function(s){s.preventDefault(),s.stopPropagation(),e(this).hide(),e(".bpbm-search form").show(),e(".bpbm-search form input").trigger("focus"),F&&e(".bp-messages-wrap .chat-header .settings").hide()}),T.on("click",".bpbm-search form span.close",function(s){s.preventDefault(),s.stopPropagation(),e(".bpbm-search form").hide(),e(".bpbm-search a.search").show(),e(".bpbm-search form input").val(""),F&&e(".bp-messages-wrap .chat-header .settings").show()}),T.on("submit",".bpbm-search form",function(s){s.preventDefault();var a=e(this).closest(".bp-messages-wrap");g(BP_Messages.url+"?"+e(this).serialize(),a)}),!1===("1"===BP_Messages.disableEnterForTouch&&F||"1"===BP_Messages.disableEnterForDesktop&&!F)&&T.on("keydown",".reply .bp-emojionearea-editor",function(s){s.shiftKey||13!=s.keyCode||(s.preventDefault(),s.stopImmediatePropagation(),e(this).trigger("blur"),e(this).parent().parent().trigger("submit"),e(this).trigger("focus"))}),T.on("change",".new-message .send-to-input",function(s){s.preventDefault(),s.stopPropagation();g(e(this).attr("href"),e(this).closest(".bp-messages-wrap"))}),F?T.on("touchend",".scroller.starred .messages-list li, .scroller.search .messages-list li",function(s){if(1!=u&&!1===b){s.preventDefault(),s.stopPropagation();var a=e(this).attr("data-thread"),t=e(this).attr("data-id");g(BP_Messages.threadUrl+a+"&message_id="+t,e(this).closest(".bp-messages-wrap"))}}).on("touchmove",function(e){u=!0}).on("touchstart",function(e){u=!1}):T.on("click",".scroller.starred .messages-list li, .scroller.search .messages-list li",function(s){s.preventDefault(),s.stopPropagation();var a=e(this).attr("data-thread"),t=e(this).attr("data-id");g(BP_Messages.threadUrl+a+"&message_id="+t,e(this).closest(".bp-messages-wrap"))}),T.on("click",".participants-panel .bp-messages-user-list .user .actions a.remove-from-thread",function(s){s.preventDefault();var a=e(this).closest(".bp-messages-wrap"),t=e(this).parent().parent(),i=t.data("id"),r=t.data("thread-id"),n=t.find(".name").text();confirm("Exclude "+n+" from this thread?")&&e.post(BP_Messages.ajaxUrl,{action:"bp_better_messages_exclude_user_from_thread",user_id:i,thread_id:r},function(s){if(!0===s.result){g(BP_Messages.url+"?"+e.param({thread_id:r,participants:"1"}),a)}})}),T.on("click",".chat-header .bpbm-mute-thread",function(s){s.preventDefault();var a=e(this).closest(".bp-messages-wrap"),t=parseInt(a.attr("data-thread-id")),i=location.href;a.is("#bp-better-messages-mini-mobile-container")&&(t=a.attr("data-thread"),i=BP_Messages.baseUrl+"?thread_id="+t);confirm(BP_Messages.strings.mute_thread)&&(a.find(".preloader").show(),e.post(BP_Messages.ajaxUrl,{action:"bp_messages_mute_thread",thread_id:t},function(s){g(i,a);e('.bp-messages-wrap .threads-list .thread[data-id="'+t+'"] .bpbm-counter-row').prepend('<span class="bpbm-thread-muted"><i class="fas fa-bell-slash"></i></span>'),BP_Messages.mutedThreads[t]=Date.now()}).always(function(){}))}),T.on("click",".chat-header .bpbm-unmute-thread",function(s){s.preventDefault();var a=e(this).closest(".bp-messages-wrap"),t=parseInt(a.attr("data-thread-id")),i=location.href;a.is("#bp-better-messages-mini-mobile-container")&&(t=a.attr("data-thread"),i=BP_Messages.baseUrl+"?thread_id="+t);confirm(BP_Messages.strings.unmute_thread)&&(a.find(".preloader").show(),e.post(BP_Messages.ajaxUrl,{action:"bp_messages_unmute_thread",thread_id:t},function(s){void 0!==BP_Messages.mutedThreads[t]&&delete BP_Messages.mutedThreads[t],e('.bp-messages-wrap .threads-list .thread[data-id="'+t+'"] .bpbm-counter-row .bpbm-thread-muted').remove(),g(i,a)}).always(function(){}))}),T.on("click",".participants-panel .add-user button",function(s){s.preventDefault();var a=e(this).closest(".bp-messages-wrap"),t=e(this).parent(),i=t.data("thread-id"),r=[];t.find('input[name="recipients[]"]').each(function(){r.push(e(this).val())}),e.post(BP_Messages.ajaxUrl,{action:"bp_better_messages_add_user_to_thread",users:r,thread_id:i},function(s){g(BP_Messages.url+"?"+e.param({thread_id:i,participants:"1"}),a)})}),"1"===BP_Messages.allowDeleteMessages&&T.on("click",".list .messages-stack.outgoing .content .messages-list li",function(s){(e(s.target).hasClass("message-content")||e(s.target).is("li")||e(s.target).hasClass("images"))&&!e(this).closest(".bp-messages-wrap").hasClass("bp-better-messages-mini")&&function(s,a){void 0===a?e(s).toggleClass("selected"):!0===a?e(s).addClass("selected"):e(s).removeClass("selected");var t=e(s).closest(".bp-messages-wrap"),i=t.find(".chat-controls"),r=t.find(".messages-stack li.selected").length;if(r>0){i.show();var n=!0,o=!0;t.find(".messages-stack.incoming li.selected").length>0&&(n=!1,o=!1),r>1&&(n=!1),n?i.find(".bpbm-edit").show():i.find(".bpbm-edit").hide(),o?i.find(".bpbm-delete").show():i.find(".bpbm-delete").hide()}else i.hide()}(this)}),T.on("click",".chat-controls a.bpbm-edit",function(s){s.preventDefault();var a=e(this).closest(".bp-messages-wrap"),t=e(this).data("wp-nonce"),i=a.find(".messages-stack li.selected").data("id");e.post(BP_Messages.ajaxUrl,{action:"bp_messages_get_edit_message",message_id:i,_wpnonce:t},function(e){a.find('.reply form input[name="message_id"]').val(i),a.find(".bp-emojionearea-editor").html(e)})}),T.on("click",".chat-controls a.bpbm-delete",function(s){s.preventDefault();var a=e(this).data("wp-nonce"),i=BP_Messages.strings.confirm_delete,r=e(this).closest(".bp-messages-wrap"),n=r.find(".messages-stack li.selected");i=i.replace("%s",n.length);if(confirm(i)){var o=[];e.each(n,function(){o.push(e(this).data("id"))}),e.post(BP_Messages.ajaxUrl,{action:"bp_messages_delete_message",thread_id:Q,messages_ids:o,_wpnonce:a},function(e){e.result?(BBPMNotice(e.message),t(o)):BBPMShowError(e.errors[0]),r.find(".chat-controls").hide()})}}),"1"==BP_Messages.miniChats&&(e(document).on("click",".bp-better-messages-mini .chats .chat > .head",function(s){var a=e(this).parent(),t=a.attr("data-thread");if(a.toggleClass("open").hasClass("open")){if(I[t]=!0,c('.bp-messages-wrap.bp-better-messages-mini .chats .chat[data-thread="'+t+'"]'),"1"==BP_Messages.realtime){o();var i=[];e('.bp-messages-wrap.bp-better-messages-mini .chats .chat[data-thread="'+t+'"] .list .messages-stack .content .messages-list li.unread:not(.fast)').each(function(){var s=e(this).data("id"),a=e(this).data("thread"),t=e(this).attr("data-time");i.push(s),e(this).removeClass("unread"),y("bp-better-messages-thread-"+a,t,1)}),S.emit("threadOpen",t),i.length>0&&S.emit("seen",i)}}else I[t]=!1;store.set("bp-better-messages-mini-chats",I)}),e(document).on("click",".bp-better-messages-mini .chats .chat > .head .open",function(s){s.stopImmediatePropagation();var a=e(this).parent().parent().parent(),t=a.attr("data-thread");a.fadeOut(),location.href=BP_Messages.threadUrl+t}),e(document).on("click",".bp-better-messages-mini .chats .chat > .head .close",function(s){s.stopImmediatePropagation();var a=e(this).parent().parent().parent(),t=a.attr("data-thread");a.slideUp(function(){a.remove()}),void 0!==I[t]&&delete I[t],store.set("bp-better-messages-mini-chats",I)}),e(".bp-messages-wrap:not(.bp-better-messages-mini,.bp-better-messages-list)").on("click",".chat-header > .mini-chat",function(s){var a=e(this).parent().parent().find(".thread[data-id]").attr("data-id");void 0!==I[a]&&delete I[a],w(a,!0)})),"1"==BP_Messages.miniMessages&&e(document).on("click",".bp-better-messages-list .threads-list .thread:not(.blocked)",function(s){s.preventDefault();var a=e(this),t=a.data("id");if("1"==BP_Messages.miniChats){var i=a.parent().parent(),r=e(a).height(),n=a.position().top;n+=i.scrollTop(),a.addClass("blocked loading"),e(a).find(".loading").css({height:r,"line-height":r+"px",top:n+"px"}),w(t,!0).always(function(e){o(),a.removeClass("blocked loading")})}else location.href=BP_Messages.threadUrl+t}),e(document).on("click",".bp-better-messages-list .tabs > div",function(s){s.preventDefault();var a=e(this).data("tab");e(this).hasClass("active")?(e(this).removeClass("active"),e(".bp-better-messages-list .tabs-content ."+a).removeClass("active"),U=!1):(e(".bp-better-messages-list .tabs > div, .bp-better-messages-list .tabs-content > div").removeClass("active"),e(this).addClass("active"),e(".bp-better-messages-list .tabs-content ."+a).addClass("active"),U=a),store.set("bp-better-messages-mini-messages",U)}),e(document).on("click",".bpbm-deleted-user-link",function(e){e.preventDefault()}),e(document).on("click",".bp-better-messages-list .bp-messages-user-list .user:not(.blocked)",function(s){if(e(s.target).is("div")){s.preventDefault();var a=e(this),t=e(this).data("id"),i=e(this).data("username");if("1"==BP_Messages.miniChats&&"1"==BP_Messages.fastStart){var r=a.parent().parent(),n=e(a).height(),o=a.position().top;o+=r.scrollTop(),e(a).find(".loading").css({height:n,"line-height":n+"px",top:o+"px"}),a.addClass("blocked loading"),_(t).always(function(e){a.removeClass("blocked loading")})}else{var l=BP_Messages.url+"?new-message&to="+i;"1"==BP_Messages.fastStart&&(l+="&fast=1"),location.href=l}}}),"1"===BP_Messages.enablePushNotifications&&"serviceWorker"in navigator&&"PushManager"in window){!1===store.get("bpbm-browser-push-proposal-clicked",!1)&&navigator.serviceWorker.register("/bpbm-worker.js",{scope:"/"}).then(function(e){e.pushManager.getSubscription().then(function(e){null===e&&jQuery.amaran({theme:"colorful",content:{bgcolor:"black",color:"#fff",message:'<span class="bpbm-browser-push-proposal"><span class="bpbm-browser-push-proposal-text">'+BP_Messages.strings.push_request+'</span><span class="bpbm-browser-push-proposal-controls"><button class="BPBMenablePushNotifications">'+BP_Messages.strings.enable+'</button><button class="BPBMdismissPushProposal">'+BP_Messages.strings.dismiss+"</button></span></span>"},sticky:!0,closeOnClick:!0,closeButton:!1,position:"bottom right",onClick:function(){store.set("bpbm-browser-push-proposal-clicked",!0)}})})})}}),jQuery(document).on("bp-better-messages-update-unread",function(e,s){var a=jQuery(".bp-better-messages-unread");s=parseInt(s),(isNaN(s)||s<0)&&(s=0),0===s?a.addClass("no-count"):a.removeClass("no-count"),a.text(s)});var Y=!1,V=!1;e(document).on("bp-better-messages-open-mini-chat",function(e,s,a){w(s,a)}),e(document).on("bp-better-messages-open-private-thread",function(e,s){_(s)});var K,G=[];"1"===BP_Messages.enablePushNotifications&&(jQuery(document).on("click",".BPBMenablePushNotifications",function(e){BPBMregisterPushWorker()}),jQuery(document).on("click",".BPBMdisablePushNotifications",function(e){BPBMunregisterPushWorker()}))}(jQuery);